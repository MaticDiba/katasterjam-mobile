import{d2 as S,r as k,eQ as P,cM as n,cN as d,d as r,d9 as a,df as _,dh as Q,F as g,d8 as m,dR as c,e9 as E,eR as w,eN as C,da as u,dc as l,eP as q}from"./index.e77f560e.js";import{a as F,c as y,Q as h}from"./format.2b2d8ff6.js";import{Q as N}from"./QSlideItem.2e84d0c5.js";import{Q as v}from"./TouchPan.87ff0154.js";import{Q as M}from"./QPullToRefresh.cdab9dda.js";import{u as I}from"./use-quasar.7a52943d.js";import{u as R}from"./excursion-store.43e71502.js";const T={name:"ExcursionSearchPage",setup(){const{dialog:e}=I(),t=R(),p=k(t.getQuery),i=k(!1);return t.getExcursions.length===0&&t.searchForExcursions().then(()=>{console.log("excursions loaded")}),{confirmDialog:e,store:t,mine:i,query:p,formatDate:P}},computed:{excursions(){return this.store.getExcursions},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},searching(){return this.store.getSearchingStatus}},watch:{query(e,t){this.executeSearch()}},methods:{canJoinExcursion(e){return!e.meParticipant&&!e.requestedJoin},excursionClick(e){this.$router.push({name:"trips-details",params:{id:e}})},joinExcursion({reset:e},t){e(),this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("joinExcursionText")}${t.name}`,cancel:!0,persistent:!0}).onOk(async()=>{await this.store.joinExcursion(t)})},async onlyMine(){this.store.onlyMyExcursions(this.mine=!this.mine),await this.store.searchForExcursions()},async executeSearch(){this.store.addQueryParameter(this.query),await this.store.searchForExcursions()},async loadMore(){this.store.incrementPageNumber(),await this.store.searchForExcursions()},async refresh(e){await this.store.searchForExcursions(),e()}}};function j(e,t,p,i,z,o){return n(),d(g,null,[r(_,{loading:o.searching,modelValue:i.query,"onUpdate:modelValue":t[1]||(t[1]=s=>i.query=s),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForExcursion")},{append:a(()=>[i.query!==""?(n(),m(c,{key:0,name:"close",onClick:t[0]||(t[0]=s=>i.query=""),class:"cursor-pointer"})):(n(),m(c,{key:1,name:"search"}))]),after:a(()=>[r(Q,{round:"",dense:"",flat:"",icon:"check",onClick:o.onlyMine,color:i.mine?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),r(M,{onRefresh:o.refresh},{default:a(()=>[r(v,{ref:"scrollTargetRef",class:"scroll"},{default:a(()=>[(n(!0),d(g,null,E(o.excursions,(s,x)=>(n(),d("div",{key:x},[r(N,{onLeft:f=>o.joinExcursion(f,s)},w({default:a(()=>[r(F,{clickable:"",onClick:f=>o.excursionClick(s.id)},{default:a(()=>[r(y,{avatar:"",top:""},{default:a(()=>[r(C,{icon:"info",color:"primary","text-color":"white"}),s.meParticipant?(n(),m(c,{key:0,name:"check",color:"green",size:"lg"})):s.requestedJoin?(n(),d(g,{key:1},[r(c,{name:"check",color:"grey",size:"smc"}),r(h,{caption:""},{default:a(()=>[u(l(e.$t("requested")),1)]),_:1})],64)):(n(),m(c,{key:2,name:"keyboard_double_arrow_right",size:"lg",color:"primary"}))]),_:2},1024),r(y,null,{default:a(()=>[r(h,{lines:"1"},{default:a(()=>[u(l(s.name),1)]),_:2},1024),r(h,{caption:""},{default:a(()=>[u(l(e.$t("date"))+": "+l(i.formatDate(s.dateOfExcursion)),1)]),_:2},1024),r(h,{caption:""},{default:a(()=>[u(l(e.$t("excursionParticipants"))+": "+l(s.participants),1)]),_:2},1024)]),_:2},1024),r(y,{side:""},{default:a(()=>[(n(!0),d(g,null,E(s.organizations,(f,b)=>(n(),m(h,{caption:"",key:b},{default:a(()=>[u(l(f.name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},[o.canJoinExcursion(s)?{name:"left",fn:a(()=>[r(c,{name:"check"}),u(" "+l(e.$t("joinExcursion")),1)]),key:"0"}:void 0]),1032,["onLeft"]),r(q)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),r(Q,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var A=S(T,[["render",j]]);export{A as default};
