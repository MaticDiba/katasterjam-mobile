import{Q as _,a as w,b as C,c as L,d as x}from"./QLayout.d652dc3a.js";import{h as o,s as Q,u as S,v as T,_ as k,x as P,y as N,z as V,A as I,r as m,B as p,c as F,j as h,C as f,D as s,d as a,E as b,G as i,H as u,Q as H,I as g,J as v,K as q,L as M,m as z}from"./index.424b4f7f.js";import{Q as B,a as A,b as D,c as $}from"./QPage.db46a2f3.js";import{u as j}from"./use-quasar.7517840a.js";import"./QResizeObserver.05d75f74.js";const J=[o("g",[o("path",{fill:"none",stroke:"currentColor","stroke-width":"5","stroke-miterlimit":"10",d:"M58.4,51.7c-0.9-0.9-1.4-2-1.4-2.3s0.5-0.4,1.4-1.4 C70.8,43.8,79.8,30.5,80,15.5H70H30H20c0.2,15,9.2,28.1,21.6,32.3c0.9,0.9,1.4,1.2,1.4,1.5s-0.5,1.6-1.4,2.5 C29.2,56.1,20.2,69.5,20,85.5h10h40h10C79.8,69.5,70.8,55.9,58.4,51.7z"}),o("clipPath",{id:"uil-hourglass-clip1"},[o("rect",{x:"15",y:"20",width:" 70",height:"25"},[o("animate",{attributeName:"height",from:"25",to:"0",dur:"1s",repeatCount:"indefinite",values:"25;0;0",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"20",to:"45",dur:"1s",repeatCount:"indefinite",values:"20;45;45",keyTimes:"0;0.5;1"})])]),o("clipPath",{id:"uil-hourglass-clip2"},[o("rect",{x:"15",y:"55",width:" 70",height:"25"},[o("animate",{attributeName:"height",from:"0",to:"25",dur:"1s",repeatCount:"indefinite",values:"0;25;25",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"80",to:"55",dur:"1s",repeatCount:"indefinite",values:"80;55;55",keyTimes:"0;0.5;1"})])]),o("path",{d:"M29,23c3.1,11.4,11.3,19.5,21,19.5S67.9,34.4,71,23H29z","clip-path":"url(#uil-hourglass-clip1)",fill:"currentColor"}),o("path",{d:"M71.6,78c-3-11.6-11.5-20-21.5-20s-18.5,8.4-21.5,20H71.6z","clip-path":"url(#uil-hourglass-clip2)",fill:"currentColor"}),o("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"180 50 50",repeatCount:"indefinite",dur:"1s",values:"0 50 50;0 50 50;180 50 50",keyTimes:"0;0.7;1"})])];var K=Q({name:"QSpinnerHourglass",props:S,setup(e){const{cSize:t,classes:n}=T(e);return()=>o("svg",{class:n.value,width:t.value,height:t.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},J)}});const O={name:"LoginPage",setup(){const e=P(),t=N(),n=V(),l=I(),r=m(0),{getPageNumber:d}=p(t),{getPageNumber:c}=p(l),{notify:y}=j();return{notify:y,loggingIn:m(!1),store:e,cavesStore:t,progress:r,progressLabel:F(()=>(r.value*100).toFixed(2)+"%"),mapStore:n,getPageNumber:d,customLocations:l,customLocationPage:c}},data(){return{account:{email:"",password:""},progressLabelTitle:this.$t("fetchingCaveData")}},watch:{getPageNumber(e,t){this.progress=e/this.cavesStore.totalPages},customLocationPage(e,t){this.progress=e/this.customLocations.getTotalPages}},methods:{async submitForm(){this.loggingIn=!0;try{const e={email:this.account.email,password:this.account.password,rememberMe:!0},t=await this.store.login(e);await this.fetchMapCapabilities(),t.success?(await this.cavesStore.tryFetchCavesForOffline(),this.progress=0,this.progressLabelTitle=this.$t("fetchingCustomLocationData"),await this.customLocations.tryFetchCustomLocationsForOffline(),this.$router.replace("/")):console.error(t.message[0])}catch(e){console.error(e),this.notify({message:this.$t("loginFailed"),color:"red"})}finally{this.loggingIn=!1}},async fetchMapCapabilities(){for(const e of this.mapStore.getLayers){const n=await(await fetch(e.url)).text();localStorage.setItem(`cap-${e.label}`,n)}}}},R={class:"column"},U={class:"row"},E={class:"text-h5 text-white q-my-md"},G={class:"row"},Y={class:"text-grey-6"},W={class:"text-grey-6"},X={class:"absolute-full flex flex-center"};function Z(e,t,n,l,r,d){return h(),f(_,{view:"lHh Lpr lFf"},{default:s(()=>[a(L,{elevated:""},{default:s(()=>[a(w,null,{default:s(()=>[a(C,null,{default:s(()=>[b(" eKatasterJam ")]),_:1})]),_:1})]),_:1}),a(x,null,{default:s(()=>[a(B,{class:"bg-light-blue row justify-center items-center"},{default:s(()=>[i("div",R,[i("div",U,[i("h5",E,u(e.$t("logIn")),1)]),i("div",G,[a(H,{bordered:"",class:"q-pa-lg shadow-1"},{default:s(()=>[a(g,null,{default:s(()=>[a(A,{class:"q-gutter-md"},{default:s(()=>[a(v,{square:"",filled:"",clearable:"",modelValue:r.account.email,"onUpdate:modelValue":t[0]||(t[0]=c=>r.account.email=c),type:"email",label:e.$t("email")},null,8,["modelValue","label"]),a(v,{square:"",filled:"",clearable:"",modelValue:r.account.password,"onUpdate:modelValue":t[1]||(t[1]=c=>r.account.password=c),type:"password",label:e.$t("password")},null,8,["modelValue","label"])]),_:1})]),_:1}),a(q,{class:"q-px-md"},{default:s(()=>[a(M,{disable:l.loggingIn,loading:l.loggingIn,unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loginLabel"),onClick:d.submitForm,type:"submit"},{loading:s(()=>[a(K,{class:"on-right"}),b(" "+u(e.$t("loggingIn")),1)]),_:1},8,["disable","loading","label","onClick"])]),_:1}),a(g,{class:"text-center q-pa-none"},{default:s(()=>[i("p",Y,u(e.$t("register")),1)]),_:1}),l.loggingIn?(h(),f(g,{key:0,class:"text-center q-pa-none"},{default:s(()=>[i("p",W,u(r.progressLabelTitle),1),a(D,{"instant-feedback":!0,size:"50px",value:l.progress,color:"accent",class:"q-mt-sm"},{default:s(()=>[i("div",X,[a($,{color:"white","text-color":"accent",label:l.progressLabel},null,8,["label"])])]),_:1},8,["value"])]),_:1})):z("",!0)]),_:1})])])]),_:1})]),_:1})]),_:1})}var le=k(O,[["render",Z]]);export{le as default};
