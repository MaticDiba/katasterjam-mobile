import{Q as w,a as y,b as C,c as L,d as Q}from"./QLayout.f6497c21.js";import{h as o,c$ as S,d0 as T,d1 as x,d2 as k,d3 as P,d4 as V,d5 as N,d6 as F,r as m,d7 as h,c as q,cM as p,d8 as f,d9 as a,d as t,da as b,db as r,dc as u,dd as H,de as g,df as v,dg as I,dh as M,cV as z}from"./index.e77f560e.js";import{Q as B,a as $,b as A,c as D}from"./QPage.f94c4a53.js";import{u as O}from"./use-quasar.7a52943d.js";import"./QResizeObserver.255d2d89.js";const R=[o("g",[o("path",{fill:"none",stroke:"currentColor","stroke-width":"5","stroke-miterlimit":"10",d:"M58.4,51.7c-0.9-0.9-1.4-2-1.4-2.3s0.5-0.4,1.4-1.4 C70.8,43.8,79.8,30.5,80,15.5H70H30H20c0.2,15,9.2,28.1,21.6,32.3c0.9,0.9,1.4,1.2,1.4,1.5s-0.5,1.6-1.4,2.5 C29.2,56.1,20.2,69.5,20,85.5h10h40h10C79.8,69.5,70.8,55.9,58.4,51.7z"}),o("clipPath",{id:"uil-hourglass-clip1"},[o("rect",{x:"15",y:"20",width:"70",height:"25"},[o("animate",{attributeName:"height",from:"25",to:"0",dur:"1s",repeatCount:"indefinite",values:"25;0;0",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"20",to:"45",dur:"1s",repeatCount:"indefinite",values:"20;45;45",keyTimes:"0;0.5;1"})])]),o("clipPath",{id:"uil-hourglass-clip2"},[o("rect",{x:"15",y:"55",width:"70",height:"25"},[o("animate",{attributeName:"height",from:"0",to:"25",dur:"1s",repeatCount:"indefinite",values:"0;25;25",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"80",to:"55",dur:"1s",repeatCount:"indefinite",values:"80;55;55",keyTimes:"0;0.5;1"})])]),o("path",{d:"M29,23c3.1,11.4,11.3,19.5,21,19.5S67.9,34.4,71,23H29z","clip-path":"url(#uil-hourglass-clip1)",fill:"currentColor"}),o("path",{d:"M71.6,78c-3-11.6-11.5-20-21.5-20s-18.5,8.4-21.5,20H71.6z","clip-path":"url(#uil-hourglass-clip2)",fill:"currentColor"}),o("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"180 50 50",repeatCount:"indefinite",dur:"1s",values:"0 50 50;0 50 50;180 50 50",keyTimes:"0;0.7;1"})])];var U=S({name:"QSpinnerHourglass",props:T,setup(e){const{cSize:s,classes:c}=x(e);return()=>o("svg",{class:c.value,width:s.value,height:s.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},R)}});const j={name:"LoginPage",setup(){const e=P(),s=V(),c=N(),l=F(),i=m(0),{getPageNumber:d}=h(s),{getPageNumber:n}=h(l),{notify:_}=O();return{notify:_,loggingIn:m(!1),store:e,cavesStore:s,progress:i,progressLabel:q(()=>(i.value*100).toFixed(2)+"%"),mapStore:c,getPageNumber:d,customLocations:l,customLocationPage:n}},data(){return{account:{email:"",password:""},progressLabelTitle:this.$t("fetchingCaveData")}},watch:{getPageNumber(e,s){this.progress=e/this.cavesStore.totalPages},customLocationPage(e,s){this.progress=e/this.customLocations.getTotalPages}},methods:{async submitForm(){this.loggingIn=!0;try{const e={email:this.account.email,password:this.account.password,rememberMe:!0},s=await this.store.login(e);await this.mapStore.fetchMapCapabilities(),s.success?(await this.cavesStore.tryFetchCavesForOffline(),this.progress=0,this.progressLabelTitle=this.$t("fetchingCustomLocationData"),await this.customLocations.tryFetchCustomLocationsForOffline(),this.progressLabelTitle=this.$t("fetchingCustomLocationTypes"),await this.customLocations.fetchCustomLocationsTypes(),this.progressLabelTitle=this.$t("fetchingCustomLocationStatuses"),await this.customLocations.fetchCustomLocationsStatuses(),this.$router.replace("/")):console.error(s.message[0])}catch(e){console.error(e),this.notify({message:this.$t("loginFailed"),color:"red"})}finally{this.loggingIn=!1}}}},J={class:"column"},K={class:"row"},Y={class:"text-h5 text-white q-my-md"},E={class:"row"},G={class:"text-grey-6"},W={class:"text-grey-6"},X={class:"absolute-full flex flex-center"};function Z(e,s,c,l,i,d){return p(),f(w,{view:"lHh Lpr lFf"},{default:a(()=>[t(L,{elevated:""},{default:a(()=>[t(y,null,{default:a(()=>[t(C,null,{default:a(()=>[b(" eKatasterJam ")]),_:1})]),_:1})]),_:1}),t(Q,null,{default:a(()=>[t(B,{class:"bg-light-blue row justify-center items-center"},{default:a(()=>[r("div",J,[r("div",K,[r("h5",Y,u(e.$t("logIn")),1)]),r("div",E,[t(H,{bordered:"",class:"q-pa-lg shadow-1"},{default:a(()=>[t(g,null,{default:a(()=>[t($,{class:"q-gutter-md"},{default:a(()=>[t(v,{square:"",filled:"",clearable:"",modelValue:i.account.email,"onUpdate:modelValue":s[0]||(s[0]=n=>i.account.email=n),type:"email",label:e.$t("email")},null,8,["modelValue","label"]),t(v,{square:"",filled:"",clearable:"",modelValue:i.account.password,"onUpdate:modelValue":s[1]||(s[1]=n=>i.account.password=n),type:"password",label:e.$t("password")},null,8,["modelValue","label"])]),_:1})]),_:1}),t(I,{class:"q-px-md"},{default:a(()=>[t(M,{disable:l.loggingIn,loading:l.loggingIn,unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loginLabel"),onClick:d.submitForm,type:"submit"},{loading:a(()=>[t(U,{class:"on-right"}),b(" "+u(e.$t("loggingIn")),1)]),_:1},8,["disable","loading","label","onClick"])]),_:1}),t(g,{class:"text-center q-pa-none"},{default:a(()=>[r("p",G,u(e.$t("register")),1)]),_:1}),l.loggingIn?(p(),f(g,{key:0,class:"text-center q-pa-none"},{default:a(()=>[r("p",W,u(i.progressLabelTitle),1),t(A,{"instant-feedback":!0,size:"50px",value:l.progress,color:"accent",class:"q-mt-sm"},{default:a(()=>[r("div",X,[t(D,{color:"white","text-color":"accent",label:l.progressLabel},null,8,["label"])])]),_:1},8,["value"])]),_:1})):z("",!0)]),_:1})])])]),_:1})]),_:1})]),_:1})}var le=k(j,[["render",Z]]);export{le as default};
