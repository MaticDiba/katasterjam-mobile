import{d2 as v,d5 as k,r,dQ as a,cM as f,d8 as w,ei as R,ej as T,d7 as U,cN as g,d as i,d9 as h,F as b,e9 as V}from"./index.513fe5bd.js";import{o as j,W as C,M as O}from"./WMTS.6c7ee097.js";const F={props:{layer:Object},setup(){const t=k();return{layerRef:r(null),mapStore:t}},async mounted(){await(async(e,c)=>{const o=localStorage.getItem(`cap-${e.label}`),n=JSON.parse(o.replace(/http:\/\//g,"https://")),l=j(n,{layer:e.layerName}),s={projection:e.projection,...l,attributions:[e.attributes],crossOrigin:"anonymous"};s.tileLoadFunction=async(_,m)=>{const y=_.getImage(),p=await R.tiles.where("tileKey").equals(m).first();if(!p){T.getTileImage(_,m,!0);return}const d=URL.createObjectURL(p.image);y.onload=function(){URL.revokeObjectURL(d)},y.src=d};const u=new C(s);this.mapStore.setSource(e,u),c.tileLayer.setVisible(this.layer.active),c.tileLayer.setSource(u)})(this.layer,this.layerRef)},watch:{layer:{deep:!0,handler:function(t,e){this.layerRef.tileLayer.setVisible(t.active)}}}};function M(t,e,c,o,n,l){const s=a("ol-tile-layer");return f(),w(s,{ref:"layerRef"},null,512)}var W=v(F,[["render",M]]);const $={components:{CustomWMTSLayer:W},setup(){const t=k(),e=r(null),c=r(null),o=r(null),n=r(null),l=new O,s=r(5),u=r(.5),_=r("black"),m=r("rgba(255, 50, 28, 0.6)"),y=r([]),{isSkyViewActive:p,isOrthoPhotoActive:d,getOrthoPhoto:L}=U(t);return{skyViewLayer:e,orthoPhotoLayer:c,isSkyViewActive:p,isOrthoPhotoActive:d,mapStore:t,getOrthoPhoto:L,osmSource:n,cavesSource:o,mvtFormat:l,radius:s,strokeWidth:u,stroke:_,fill:m,highlightedFeatures:y}},watch:{isSkyViewActive(t,e){this.skyViewLayer.tileLayer.setVisible(t)}},async mounted(){var t;(t=this.osmSource.source)==null||t.setTileLoadFunction(async(e,c)=>{const o=e.getImage(),n=c.replace(/^(https?:\/\/)[abc]\./,"$1"),l=await R.tiles.where("tileKey").equals(n).first();if(!l){T.getTileImage(e,c);return}const s=URL.createObjectURL(l.image);o.onload=function(){URL.revokeObjectURL(s)},o.src=s}),this.mapStore.getCavesLayerSource().then(e=>{this.cavesSource.vectorLayer.setSource(e)})}};function x(t,e,c,o,n,l){const s=a("ol-source-osm"),u=a("ol-tile-layer"),_=a("CustomWMTSLayer"),m=a("ol-style-fill"),y=a("ol-style-stroke"),p=a("ol-style-circle"),d=a("ol-style"),L=a("ol-vector-layer");return f(),g(b,null,[i(u,null,{default:h(()=>[i(s,{ref:"osmSource"},null,512)]),_:1}),(f(!0),g(b,null,V(o.mapStore.getLayers,S=>(f(),w(_,{key:S.name,layer:S},null,8,["layer"]))),128)),i(L,{ref:"cavesSource"},{default:h(()=>[i(d,null,{default:h(()=>[i(p,{radius:o.radius},{default:h(()=>[i(m,{color:o.fill},null,8,["color"]),i(y,{color:o.stroke,width:o.strokeWidth},null,8,["color","width"])]),_:1},8,["radius"])]),_:1})]),_:1},512)],64)}var A=v($,[["render",x]]);export{A as C};
