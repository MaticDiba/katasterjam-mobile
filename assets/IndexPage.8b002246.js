import{Q as Mt}from"./QResizeObserver.118a0d3b.js";import{Q as dt,a as W}from"./QFab.a3c7dbfb.js";import{i as Bt,N as Z,O as $t,c as R,g as Pt,M as Nt,h as nt,s as Ct,aC as wt,aD as Xt,aE as Ot,aF as k,aG as Lt,aH as it,aI as Yt,aJ as kt,aK as J,aL as ft,aM as Vt,aN as qt,aO as pt,aP as Ut,aQ as Gt,aR as Qt,aS as zt,aT as Kt,aU as Ht,_ as A,j as x,C as I,D as u,l as jt,aV as Wt,as as Zt,aW as at,r as y,am as m,d as l,aX as mt,aY as gt,k as T,Q as st,I as D,G as b,H as g,an as It,aZ as Ft,L as M,a_ as lt,F as G,B as ct,a$ as Jt,b0 as j,b1 as ut,b2 as te,m as U,A as ee,b3 as Tt,at as oe,b4 as ne,b5 as ie,ar as re,z as ht,b6 as ae,ai as se,b7 as Rt,J as le,E,b8 as X,K as ce,al as ue}from"./index.1cf7b810.js";import{Q as he,a as de,b as fe,c as pe}from"./QPage.2898eeb7.js";import{C as me}from"./CartoLayers.088f3153.js";import{u as St}from"./use-quasar.bcfc30a7.js";import{Q as C,a as O,b as F}from"./QItem.53dc868c.js";const ge={position:{type:String,default:"bottom-right",validator:n=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(n)},offset:{type:Array,validator:n=>n.length===2},expand:Boolean};function _e(){const{props:n,proxy:{$q:t}}=Pt(),e=Bt($t,Z);if(e===Z)return console.error("QPageSticky needs to be child of QLayout"),Z;const o=R(()=>{const f=n.position;return{top:f.indexOf("top")>-1,right:f.indexOf("right")>-1,bottom:f.indexOf("bottom")>-1,left:f.indexOf("left")>-1,vertical:f==="top"||f==="bottom",horizontal:f==="left"||f==="right"}}),i=R(()=>e.header.offset),r=R(()=>e.right.offset),a=R(()=>e.footer.offset),s=R(()=>e.left.offset),c=R(()=>{let f=0,p=0;const _=o.value,v=t.lang.rtl===!0?-1:1;_.top===!0&&i.value!==0?p=`${i.value}px`:_.bottom===!0&&a.value!==0&&(p=`${-a.value}px`),_.left===!0&&s.value!==0?f=`${v*s.value}px`:_.right===!0&&r.value!==0&&(f=`${-v*r.value}px`);const w={transform:`translate(${f}, ${p})`};return n.offset&&(w.margin=`${n.offset[1]}px ${n.offset[0]}px`),_.vertical===!0?(s.value!==0&&(w[t.lang.rtl===!0?"right":"left"]=`${s.value}px`),r.value!==0&&(w[t.lang.rtl===!0?"left":"right"]=`${r.value}px`)):_.horizontal===!0&&(i.value!==0&&(w.top=`${i.value}px`),a.value!==0&&(w.bottom=`${a.value}px`)),w}),h=R(()=>`q-page-sticky row flex-center fixed-${n.position} q-page-sticky--${n.expand===!0?"expand":"shrink"}`);function d(f){const p=Nt(f.default);return nt("div",{class:h.value,style:c.value},n.expand===!0?p:[nt("div",p)])}return{$layout:e,getStickyContent:d}}var tt=Ct({name:"QPageSticky",props:ge,setup(n,{slots:t}){const{getStickyContent:e}=_e();return()=>e(t)}}),N={ADD:"add",REMOVE:"remove"},bt=globalThis&&globalThis.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),_t={LENGTH:"length"},z=function(n){bt(t,n);function t(e,o,i){var r=n.call(this,e)||this;return r.element=o,r.index=i,r}return t}(wt),ve=function(n){bt(t,n);function t(e,o){var i=n.call(this)||this;i.on,i.once,i.un;var r=o||{};if(i.unique_=!!r.unique,i.array_=e||[],i.unique_)for(var a=0,s=i.array_.length;a<s;++a)i.assertUnique_(i.array_[a],a);return i.updateLength_(),i}return t.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},t.prototype.extend=function(e){for(var o=0,i=e.length;o<i;++o)this.push(e[o]);return this},t.prototype.forEach=function(e){for(var o=this.array_,i=0,r=o.length;i<r;++i)e(o[i],i,o)},t.prototype.getArray=function(){return this.array_},t.prototype.item=function(e){return this.array_[e]},t.prototype.getLength=function(){return this.get(_t.LENGTH)},t.prototype.insertAt=function(e,o){this.unique_&&this.assertUnique_(o),this.array_.splice(e,0,o),this.updateLength_(),this.dispatchEvent(new z(N.ADD,o,e))},t.prototype.pop=function(){return this.removeAt(this.getLength()-1)},t.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var o=this.getLength();return this.insertAt(o,e),this.getLength()},t.prototype.remove=function(e){for(var o=this.array_,i=0,r=o.length;i<r;++i)if(o[i]===e)return this.removeAt(i)},t.prototype.removeAt=function(e){var o=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new z(N.REMOVE,o,e)),o},t.prototype.setAt=function(e,o){var i=this.getLength();if(e<i){this.unique_&&this.assertUnique_(o,e);var r=this.array_[e];this.array_[e]=o,this.dispatchEvent(new z(N.REMOVE,r,e)),this.dispatchEvent(new z(N.ADD,o,e))}else{for(var a=i;a<e;++a)this.insertAt(a,void 0);this.insertAt(e,o)}},t.prototype.updateLength_=function(){this.set(_t.LENGTH,this.array_.length)},t.prototype.assertUnique_=function(e,o){for(var i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===e&&i!==o)throw new Xt(58)},t}(Ot),ye=ve;function xe(n,t,e,o,i){At(n,t,e||0,o||n.length-1,i||Ee)}function At(n,t,e,o,i){for(;o>e;){if(o-e>600){var r=o-e+1,a=t-e+1,s=Math.log(r),c=.5*Math.exp(2*s/3),h=.5*Math.sqrt(s*c*(r-c)/r)*(a-r/2<0?-1:1),d=Math.max(e,Math.floor(t-a*c/r+h)),f=Math.min(o,Math.floor(t+(r-a)*c/r+h));At(n,t,d,f,i)}var p=n[t],_=e,v=o;for(Y(n,e,t),i(n[o],p)>0&&Y(n,e,o);_<v;){for(Y(n,_,v),_++,v--;i(n[_],p)<0;)_++;for(;i(n[v],p)>0;)v--}i(n[e],p)===0?Y(n,e,v):(v++,Y(n,v,o)),v<=t&&(e=v+1),t<=v&&(o=v-1)}}function Y(n,t,e){var o=n[t];n[t]=n[e],n[e]=o}function Ee(n,t){return n<t?-1:n>t?1:0}class Ce{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const o=[];if(!H(t,e))return o;const i=this.toBBox,r=[];for(;e;){for(let a=0;a<e.children.length;a++){const s=e.children[a],c=e.leaf?i(s):s;H(t,c)&&(e.leaf?o.push(s):ot(t,c)?this._all(s,o):r.push(s))}e=r.pop()}return o}collides(t){let e=this.data;if(!H(t,e))return!1;const o=[];for(;e;){for(let i=0;i<e.children.length;i++){const r=e.children[i],a=e.leaf?this.toBBox(r):r;if(H(t,a)){if(e.leaf||ot(t,a))return!0;o.push(r)}}e=o.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let o=0;o<t.length;o++)this.insert(t[o]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const o=this.data;this.data=e,e=o}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=P([]),this}remove(t,e){if(!t)return this;let o=this.data;const i=this.toBBox(t),r=[],a=[];let s,c,h;for(;o||r.length;){if(o||(o=r.pop(),c=r[r.length-1],s=a.pop(),h=!0),o.leaf){const d=we(t,o.children,e);if(d!==-1)return o.children.splice(d,1),r.push(o),this._condense(r),this}!h&&!o.leaf&&ot(o,i)?(r.push(o),a.push(s),s=0,c=o,o=o.children[0]):c?(s++,o=c.children[s],h=!1):o=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const o=[];for(;t;)t.leaf?e.push(...t.children):o.push(...t.children),t=o.pop();return e}_build(t,e,o,i){const r=o-e+1;let a=this._maxEntries,s;if(r<=a)return s=P(t.slice(e,o+1)),$(s,this.toBBox),s;i||(i=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,i-1))),s=P([]),s.leaf=!1,s.height=i;const c=Math.ceil(r/a),h=c*Math.ceil(Math.sqrt(a));vt(t,e,o,h,this.compareMinX);for(let d=e;d<=o;d+=h){const f=Math.min(d+h-1,o);vt(t,d,f,c,this.compareMinY);for(let p=d;p<=f;p+=c){const _=Math.min(p+c-1,f);s.children.push(this._build(t,p,_,i-1))}}return $(s,this.toBBox),s}_chooseSubtree(t,e,o,i){for(;i.push(e),!(e.leaf||i.length-1===o);){let r=1/0,a=1/0,s;for(let c=0;c<e.children.length;c++){const h=e.children[c],d=et(h),f=Ie(t,h)-d;f<a?(a=f,r=d<r?d:r,s=h):f===a&&d<r&&(r=d,s=h)}e=s||e.children[0]}return e}_insert(t,e,o){const i=o?t:this.toBBox(t),r=[],a=this._chooseSubtree(i,this.data,e,r);for(a.children.push(t),q(a,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)}_split(t,e){const o=t[e],i=o.children.length,r=this._minEntries;this._chooseSplitAxis(o,r,i);const a=this._chooseSplitIndex(o,r,i),s=P(o.children.splice(a,o.children.length-a));s.height=o.height,s.leaf=o.leaf,$(o,this.toBBox),$(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(o,s)}_splitRoot(t,e){this.data=P([t,e]),this.data.height=t.height+1,this.data.leaf=!1,$(this.data,this.toBBox)}_chooseSplitIndex(t,e,o){let i,r=1/0,a=1/0;for(let s=e;s<=o-e;s++){const c=V(t,0,s,this.toBBox),h=V(t,s,o,this.toBBox),d=Fe(c,h),f=et(c)+et(h);d<r?(r=d,i=s,a=f<a?f:a):d===r&&f<a&&(a=f,i=s)}return i||o-e}_chooseSplitAxis(t,e,o){const i=t.leaf?this.compareMinX:Le,r=t.leaf?this.compareMinY:ke,a=this._allDistMargin(t,e,o,i),s=this._allDistMargin(t,e,o,r);a<s&&t.children.sort(i)}_allDistMargin(t,e,o,i){t.children.sort(i);const r=this.toBBox,a=V(t,0,e,r),s=V(t,o-e,o,r);let c=K(a)+K(s);for(let h=e;h<o-e;h++){const d=t.children[h];q(a,t.leaf?r(d):d),c+=K(a)}for(let h=o-e-1;h>=e;h--){const d=t.children[h];q(s,t.leaf?r(d):d),c+=K(s)}return c}_adjustParentBBoxes(t,e,o){for(let i=o;i>=0;i--)q(e[i],t)}_condense(t){for(let e=t.length-1,o;e>=0;e--)t[e].children.length===0?e>0?(o=t[e-1].children,o.splice(o.indexOf(t[e]),1)):this.clear():$(t[e],this.toBBox)}}function we(n,t,e){if(!e)return t.indexOf(n);for(let o=0;o<t.length;o++)if(e(n,t[o]))return o;return-1}function $(n,t){V(n,0,n.children.length,t,n)}function V(n,t,e,o,i){i||(i=P(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let r=t;r<e;r++){const a=n.children[r];q(i,n.leaf?o(a):a)}return i}function q(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function Le(n,t){return n.minX-t.minX}function ke(n,t){return n.minY-t.minY}function et(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function K(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Ie(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function Fe(n,t){const e=Math.max(n.minX,t.minX),o=Math.max(n.minY,t.minY),i=Math.min(n.maxX,t.maxX),r=Math.min(n.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,r-o)}function ot(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function H(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function P(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vt(n,t,e,o,i){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=o)continue;const a=t+Math.ceil((e-t)/o/2)*o;xe(n,a,t,e,i),r.push(t,a,a,e)}}var Te=function(){function n(t){this.rbush_=new Ce(t),this.items_={}}return n.prototype.insert=function(t,e){var o={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(o),this.items_[k(e)]=o},n.prototype.load=function(t,e){for(var o=new Array(e.length),i=0,r=e.length;i<r;i++){var a=t[i],s=e[i],c={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};o[i]=c,this.items_[k(s)]=c}this.rbush_.load(o)},n.prototype.remove=function(t){var e=k(t),o=this.items_[e];return delete this.items_[e],this.rbush_.remove(o)!==null},n.prototype.update=function(t,e){var o=this.items_[k(e)],i=[o.minX,o.minY,o.maxX,o.maxY];Lt(i,t)||(this.remove(e),this.insert(t,e))},n.prototype.getAll=function(){var t=this.rbush_.all();return t.map(function(e){return e.value})},n.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]},o=this.rbush_.search(e);return o.map(function(i){return i.value})},n.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},n.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},n.prototype.forEach_=function(t,e){for(var o,i=0,r=t.length;i<r;i++)if(o=e(t[i]),o)return o;return o},n.prototype.isEmpty=function(){return it(this.items_)},n.prototype.clear=function(){this.rbush_.clear(),this.items_={}},n.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return Yt(e.minX,e.minY,e.maxX,e.maxY,t)},n.prototype.concat=function(t){this.rbush_.load(t.rbush_.all());for(var e in t.items_)this.items_[e]=t.items_[e]},n}(),yt=Te,L={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Re(n,t){return[[-1/0,-1/0,1/0,1/0]]}var Se=!1;function be(n,t,e,o,i,r,a){var s=new XMLHttpRequest;s.open("GET",typeof n=="function"?n(e,o,i):n,!0),t.getType()=="arraybuffer"&&(s.responseType="arraybuffer"),s.withCredentials=Se,s.onload=function(c){if(!s.status||s.status>=200&&s.status<300){var h=t.getType(),d=void 0;h=="json"||h=="text"?d=s.responseText:h=="xml"?(d=s.responseXML,d||(d=new DOMParser().parseFromString(s.responseText,"application/xml"))):h=="arraybuffer"&&(d=s.response),d?r(t.readFeatures(d,{extent:e,featureProjection:i}),t.readProjection(d)):a()}else a()},s.onerror=a,s.send()}function xt(n,t){return function(e,o,i,r,a){var s=this;be(n,t,e,o,i,function(c,h){s.addFeatures(c),r!==void 0&&r(c)},a||kt)}}var Dt=globalThis&&globalThis.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function o(){this.constructor=t}t.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),S=function(n){Dt(t,n);function t(e,o,i){var r=n.call(this,e)||this;return r.feature=o,r.features=i,r}return t}(wt),Ae=function(n){Dt(t,n);function t(e){var o=this,i=e||{};o=n.call(this,{attributions:i.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:i.wrapX!==void 0?i.wrapX:!0})||this,o.on,o.once,o.un,o.loader_=kt,o.format_=i.format,o.overlaps_=i.overlaps===void 0?!0:i.overlaps,o.url_=i.url,i.loader!==void 0?o.loader_=i.loader:o.url_!==void 0&&(J(o.format_,7),o.loader_=xt(o.url_,o.format_)),o.strategy_=i.strategy!==void 0?i.strategy:Re;var r=i.useSpatialIndex!==void 0?i.useSpatialIndex:!0;o.featuresRtree_=r?new yt:null,o.loadedExtentsRtree_=new yt,o.loadingExtentsCount_=0,o.nullGeometryFeatures_={},o.idIndex_={},o.uidIndex_={},o.featureChangeKeys_={},o.featuresCollection_=null;var a,s;return Array.isArray(i.features)?s=i.features:i.features&&(a=i.features,s=a.getArray()),!r&&a===void 0&&(a=new ye(s)),s!==void 0&&o.addFeaturesInternal(s),a!==void 0&&o.bindFeaturesCollection_(a),o}return t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var o=k(e);if(!this.addToIndex_(o,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(o,e);var i=e.getGeometry();if(i){var r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[o]=e;this.dispatchEvent(new S(L.ADDFEATURE,e))},t.prototype.setupChangeEvents_=function(e,o){this.featureChangeKeys_[e]=[ft(o,Vt.CHANGE,this.handleFeatureChange_,this),ft(o,qt.PROPERTYCHANGE,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,o){var i=!0,r=o.getId();return r!==void 0&&(r.toString()in this.idIndex_?i=!1:this.idIndex_[r.toString()]=o),i&&(J(!(e in this.uidIndex_),30),this.uidIndex_[e]=o),i},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var o=[],i=[],r=[],a=0,s=e.length;a<s;a++){var c=e[a],h=k(c);this.addToIndex_(h,c)&&i.push(c)}for(var a=0,d=i.length;a<d;a++){var c=i[a],h=k(c);this.setupChangeEvents_(h,c);var f=c.getGeometry();if(f){var p=f.getExtent();o.push(p),r.push(c)}else this.nullGeometryFeatures_[h]=c}if(this.featuresRtree_&&this.featuresRtree_.load(o,r),this.hasListener(L.ADDFEATURE))for(var a=0,_=i.length;a<_;a++)this.dispatchEvent(new S(L.ADDFEATURE,i[a]))},t.prototype.bindFeaturesCollection_=function(e){var o=!1;this.addEventListener(L.ADDFEATURE,function(i){o||(o=!0,e.push(i.feature),o=!1)}),this.addEventListener(L.REMOVEFEATURE,function(i){o||(o=!0,e.remove(i.feature),o=!1)}),e.addEventListener(N.ADD,function(i){o||(o=!0,this.addFeature(i.element),o=!1)}.bind(this)),e.addEventListener(N.REMOVE,function(i){o||(o=!0,this.removeFeature(i.element),o=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var o in this.featureChangeKeys_){var i=this.featureChangeKeys_[o];i.forEach(pt)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var r=function(c){this.removeFeatureInternal(c)}.bind(this);this.featuresRtree_.forEach(r);for(var a in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[a])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var s=new S(L.CLEAR);this.dispatchEvent(s),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,o){var i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(r){var a=r.getGeometry();if(a.intersectsCoordinate(e))return o(r)})},t.prototype.forEachFeatureInExtent=function(e,o){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,o);this.featuresCollection_&&this.featuresCollection_.forEach(o)},t.prototype.forEachFeatureIntersectingExtent=function(e,o){return this.forEachFeatureInExtent(e,function(i){var r=i.getGeometry();if(r.intersectsExtent(e)){var a=o(i);if(a)return a}})},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),it(this.nullGeometryFeatures_)||Ut(e,Gt(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var o=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){o.push(i)}),o},t.prototype.getFeaturesInExtent=function(e,o){var i=this;if(this.featuresRtree_){var r=o&&o.canWrapX()&&this.getWrapX();if(!r)return this.featuresRtree_.getInExtent(e);var a=Qt(e,o);return[].concat.apply([],a.map(function(s){return i.featuresRtree_.getInExtent(s)}))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},t.prototype.getClosestFeatureToCoordinate=function(e,o){var i=e[0],r=e[1],a=null,s=[NaN,NaN],c=1/0,h=[-1/0,-1/0,1/0,1/0],d=o||Kt;return this.featuresRtree_.forEachInExtent(h,function(f){if(d(f)){var p=f.getGeometry(),_=c;if(c=p.closestPointXY(i,r,s,c),c<_){a=f;var v=Math.sqrt(c);h[0]=i-v,h[1]=r-v,h[2]=i+v,h[3]=r+v}}}),a},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var o=this.idIndex_[e.toString()];return o!==void 0?o:null},t.prototype.getFeatureByUid=function(e){var o=this.uidIndex_[e];return o!==void 0?o:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var o=e.target,i=k(o),r=o.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(o),this.nullGeometryFeatures_[i]=o);else{var a=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,o)):this.featuresRtree_&&this.featuresRtree_.update(a,o)}var s=o.getId();if(s!==void 0){var c=s.toString();this.idIndex_[c]!==o&&(this.removeFromIdIndex_(o),this.idIndex_[c]=o)}else this.removeFromIdIndex_(o),this.uidIndex_[i]=o;this.changed(),this.dispatchEvent(new S(L.CHANGEFEATURE,o))},t.prototype.hasFeature=function(e){var o=e.getId();return o!==void 0?o in this.idIndex_:k(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&it(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},t.prototype.loadFeatures=function(e,o,i){for(var r=this.loadedExtentsRtree_,a=this.strategy_(e,o,i),s=function(f,p){var _=a[f],v=r.forEachInExtent(_,function(w){return Ht(w.extent,_)});v||(++c.loadingExtentsCount_,c.dispatchEvent(new S(L.FEATURESLOADSTART)),c.loader_.call(c,_,o,i,function(w){--this.loadingExtentsCount_,this.dispatchEvent(new S(L.FEATURESLOADEND,void 0,w))}.bind(c),function(){--this.loadingExtentsCount_,this.dispatchEvent(new S(L.FEATURESLOADERROR))}.bind(c)),r.insert(_,{extent:_.slice()}))},c=this,h=0,d=a.length;h<d;++h)s(h);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),n.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var o=this.loadedExtentsRtree_,i;o.forEachInExtent(e,function(r){if(Lt(r.extent,e))return i=r,!0}),i&&o.remove(i)},t.prototype.removeFeature=function(e){if(!!e){var o=k(e);o in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[o]:this.featuresRtree_&&this.featuresRtree_.remove(e);var i=this.removeFeatureInternal(e);i&&this.changed()}},t.prototype.removeFeatureInternal=function(e){var o=k(e),i=this.featureChangeKeys_[o];if(!!i){i.forEach(pt),delete this.featureChangeKeys_[o];var r=e.getId();return r!==void 0&&delete this.idIndex_[r.toString()],delete this.uidIndex_[o],this.dispatchEvent(new S(L.REMOVEFEATURE,e)),e}},t.prototype.removeFromIdIndex_=function(e){var o=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],o=!0;break}return o},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){J(this.format_,7),this.url_=e,this.setLoader(xt(e,this.format_))},t}(zt),De=Ae;const Me={name:"PageFullScreen",methods:{tweak(){return{height:this.$q.screen.height-50+"px"}},myTweak(n){n||(n=0);const t=this.$q.platform.is.cordova?`calc(100vh - ${n}px)`:window.innerHeight-n+"px";return this.$store.state.windowSize=t,{minHeight:t}}}};function Be(n,t,e,o,i,r){return x(),I(he,{"style-fn":r.tweak,class:"scroll-y fhpadd"},{default:u(()=>[jt(n.$slots,"default")]),_:3},8,["style-fn"])}var $e=A(Me,[["render",Be]]);const Q=Wt("location",{state:()=>({foregroundLocationActivated:!1,isCordova:Zt.is.cordova,projection:null,rotation:45,watchId:null,locationTracking:!1,navigationActive:!1,myLocation:{},myTrack:[],navigateTo:[]}),getters:{getProjection(n){return n.projection},getRotation(n){return n.rotation},getLocationTracking(n){return n.locationTracking},getNavigationActive(n){return n.navigationActive},getMyLocation(n){return n.myLocation},getMyLocationAccuracy(n){return n.myLocation.accuracy},getMyLocationCoordinates(n){return n.myLocation.coordinates},getMyTrack(n){return n.myTrack},getNavigateTo(n){return n.navigateTo},foregroundNotNeeded(n){return!n.locationTracking&&!n.navigationActive}},actions:{initialize(n){this.projection=n,this.isCordova&&(window.BackgroundGeolocation.configure({locationProvider:window.BackgroundGeolocation.DISTANCE_FILTER_PROVIDER,desiredAccuracy:window.BackgroundGeolocation.MEDIUM_ACCURACY,stationaryRadius:10,distanceFilter:10,stopOnTerminate:!1,debug:!0,startForeground:!0,notificationsEnabled:!0,httpHeaders:{"X-Auth":"\u010De ga rabi\u0161"},interval:5e3,fastestInterval:2e3,activitiesInterval:1e3}),window.BackgroundGeolocation.on("authorization",t=>{t!==window.BackgroundGeolocation.AUTHORIZED&&setTimeout(()=>{navigator.notification.confirm("Please enable location access",e=>{e===1&&window.BackgroundGeolocation.showAppSettings()},"Kataster jam")},1e3)}),window.BackgroundGeolocation.on("location",t=>{this.newLocationUpdate(t)}),this.initCompass(),document.addEventListener("pause",t=>{console.log("pause: ",this.watchId),this.watchId&&navigator.compass.clearWatch(this.watchId)},!1),document.addEventListener("resume",t=>{console.log("resume: ",this.watchId),this.initCompass()},!1)),navigator.geolocation.watchPosition(t=>{this.foregroundLocationActivated&&t.coords.accuracy>10&&this.isCordova||this.newLocationUpdate(t.coords)},(t,e)=>{console.error("Error when trying to fetch location",t,e)},{enableHighAccuracy:!0})},newLocationUpdate(n){const t=at([n.longitude,n.latitude]);this.myLocation={coordinates:t,accuracy:n.accuracy,latitude:n.latitude,longitude:n.longitude},this.getLocationTracking&&this.updateMyTrack(t),this.getNavigationActive&&this.updateNavigation(t)},toggleLocationTracking(){this.locationTracking=!this.locationTracking,this.locationTracking&&this.isCordova&&window.BackgroundGeolocation.configure({notificationTitle:"Location tracking",notificationText:"Tracking your location is in progress"}),this.locationTracking?this.startForeground():this.stopForeground()},stopNavigation(){this.navigationActive=!1,this.stopForeground(),this.updateNavigation([])},startNavigation(n){this.goTo=n,this.navigateTo.length===2&&(this.navigateTo[0]=this.goTo.getGeometry().getCoordinates()),this.isCordova&&window.BackgroundGeolocation.configure({notificationTitle:"Navigation",notificationText:"Navigation to a location is in progress"}),this.navigationActive=!0,this.startForeground()},startForeground(){this.foregroundLocationActivated||(this.isCordova&&window.BackgroundGeolocation.start(),this.foregroundLocationActivated=!0)},stopForeground(){this.foregroundLocationActivated&&this.foregroundNotNeeded&&(this.isCordova&&window.BackgroundGeolocation.stop(),this.foregroundLocationActivated=!1)},updateMyTrack(n){this.myTrack.push(n)},updateNavigation(n){this.navigateTo=n.length===0?[]:[this.goTo.getGeometry().getCoordinates(),n]},initCompass(){this.watchId=navigator.compass.watchHeading(n=>{this.rotation=n.magneticHeading},n=>{alert("Compass error: "+n.code)},{frequency:1e3})}}}),Pe={setup(){const n=Q(),t=y(5),e=y("red");return{store:n,strokeWidth:t,strokeColor:e}},computed:{myTrack(){return this.store.getMyTrack}}};function Ne(n,t,e,o,i,r){const a=m("ol-geom-line-string"),s=m("ol-style-stroke"),c=m("ol-style"),h=m("ol-feature"),d=m("ol-source-vector"),f=m("ol-vector-layer");return x(),I(f,null,{default:u(()=>[l(d,null,{default:u(()=>[l(h,null,{default:u(()=>[l(a,{coordinates:r.myTrack},null,8,["coordinates"]),l(c,null,{default:u(()=>[l(s,{color:o.strokeColor,width:o.strokeWidth},null,8,["color","width"])]),_:1})]),_:1})]),_:1})]),_:1})}var Xe=A(Pe,[["render",Ne]]);const Oe=nt("div",{class:"q-space"});var rt=Ct({name:"QSpace",setup(){return()=>Oe}});const Ye={setup(){const n=y(!0),t=y("top"),e=Q(),o=y(3),i=y("green");return{dialog:n,position:t,store:e,strokeWidth:o,strokeColor:i}},data(){return{currentCenter:this.center,currentZoom:this.zoom,currentResolution:this.resolution,fixedCenter:!1,name:this.$route.query.name}},computed:{bearing(){return(([e,o],[i,r])=>{const a=i-e,s=r-o;return(Math.atan2(a,s)*180/Math.PI+360)%360})(this.store.getNavigateTo[1],this.store.getNavigateTo[0])-this.store.getRotation},navigateTo(){return this.store.getNavigateTo},navigationInProgress(){return this.store.getNavigateTo.length>0},distance(){const n=new mt(this.store.getNavigateTo),t=gt(n);return t>1e3?(t/1e3).toFixed(2):parseInt(t)},distanceUnit(){const n=new mt(this.store.getNavigateTo);return gt(n)>1e3?"km":"m"}},methods:{stopNavigation(){this.store.stopNavigation()}}},Ve={class:"text-weight-bold"},qe={class:"text-grey"};function Ue(n,t,e,o,i,r){const a=m("ol-geom-line-string"),s=m("ol-style-stroke"),c=m("ol-style"),h=m("ol-feature"),d=m("ol-source-vector"),f=m("ol-vector-layer");return x(),T(G,null,[l(lt,{modelValue:r.navigationInProgress,"onUpdate:modelValue":t[0]||(t[0]=p=>r.navigationInProgress=p),position:o.position,seamless:"",class:"q-dialog__top50"},{default:u(()=>[l(st,{style:{width:"350px"}},{default:u(()=>[l(D,{class:"row items-center no-wrap"},{default:u(()=>[b("div",null,[b("div",Ve,g(n.$t("goTo"))+": "+g(i.name),1),b("div",qe,g(n.$t("distance"))+": "+g(r.distance)+" "+g(r.distanceUnit),1)]),l(rt),l(It,{name:"navigation",style:Ft({rotate:r.bearing+"deg"}),size:"lg"},null,8,["style"]),l(M,{flat:"",round:"",icon:"stop",onClick:r.stopNavigation},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),l(f,null,{default:u(()=>[l(d,null,{default:u(()=>[l(h,null,{default:u(()=>[l(a,{coordinates:r.navigateTo},null,8,["coordinates"]),l(c,null,{default:u(()=>[l(s,{color:o.strokeColor,width:o.strokeWidth},null,8,["color","width"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}var Ge=A(Ye,[["render",Ue]]);const Qe={props:["view"],emits:["centerChanged"],components:{TrackingLayer:Xe,NavigationLayer:Ge},setup(){const n=Q(),t=y([]),e=y([]),{myLocation:o}=ct(n);return{store:n,myLocationCoordinates:t,myLocationFeatures:e,myLocation:o}},computed:{rotation(){return this.store.getRotation}},watch:{myLocation(n,t){const e=Jt([n.longitude,n.latitude],this.store.getMyLocationAccuracy);this.myLocationFeatures=[new j(e.transform("EPSG:4326",this.store.getProjection)),new j(new ut(this.store.getMyLocationCoordinates))],this.myLocationCoordinates=n.coordinates,this.$emit("centerChanged",this.store.getMyLocationCoordinates)}}};function ze(n,t,e,o,i,r){const a=m("ol-source-vector"),s=m("ol-vector-layer"),c=m("ol-overlay"),h=m("TrackingLayer"),d=m("NavigationLayer");return x(),T(G,null,[l(s,null,{default:u(()=>[l(a,{features:o.myLocationFeatures},null,8,["features"])]),_:1}),o.myLocationFeatures.length>0?(x(),I(c,{key:0,position:o.myLocationCoordinates,positioning:"center-center"},{default:u(f=>[l(It,{name:"navigation",class:te(f),style:Ft({rotate:r.rotation+"deg"}),size:"lg"},null,8,["class","style"])]),_:1},8,["position"])):U("",!0),l(h),l(d)],64)}var Ke=A(Qe,[["render",ze]]);const He={setup(){const n=ee(),t=y([]),e=y(new De);return n.loadForMap().then(()=>{n.customLocationsForMap.map(o=>t.value.push(o))}),{vectorSource:e,store:n,customLocations:t}}};function je(n,t,e,o,i,r){const a=m("ol-geom-point"),s=m("ol-style-icon"),c=m("ol-style"),h=m("ol-feature"),d=m("ol-source-vector"),f=m("ol-vector-layer");return x(),I(f,null,{default:u(()=>[l(d,{ref:"vectorSource"},{default:u(()=>[(x(!0),T(G,null,Tt(o.customLocations,p=>(x(),I(h,{key:p.id,properties:{id:p.id,name:p.name,lat:p.lat.toFixed(5),lng:p.lng.toFixed(5),type:"poi"}},{default:u(()=>[l(a,{coordinates:p.latLng},null,8,["coordinates"]),l(c,null,{default:u(()=>[l(s,{src:p.icon,scale:1},null,8,["src"])]),_:2},1024)]),_:2},1032,["properties"]))),128))]),_:1},512)]),_:1})}var We=A(He,[["render",je]]);function Et(n){if(n===!1)return 0;if(n===!0||n===void 0)return 1;const t=parseInt(n,10);return isNaN(t)?0:t}var Ze=oe({name:"close-popup",beforeMount(n,{value:t}){const e={depth:Et(t),handler(o){e.depth!==0&&setTimeout(()=>{const i=ne(n);i!==void 0&&ie(i,o,e.depth)})},handlerKey(o){re(o,13)===!0&&e.handler(o)}};n.__qclosepopup=e,n.addEventListener("click",e.handler),n.addEventListener("keyup",e.handlerKey)},updated(n,{value:t,oldValue:e}){t!==e&&(n.__qclosepopup.depth=Et(t))},beforeUnmount(n){const t=n.__qclosepopup;n.removeEventListener("click",t.handler),n.removeEventListener("keyup",t.handlerKey),delete n.__qclosepopup}});const Je={setup(){const n=St(),t=ht(),e=Q();t.hideDrawer();const o=y(!1),{showBottomDrawer:i}=ct(t);return{dialog:o,confirmDialog:n.dialog,mapStore:t,locationStore:e,showBottomDrawer:i}},computed:{clickedFeature(){return this.mapStore.getClickedFeature},drawerLoading(){return this.mapStore.getDrawerLoading}},methods:{hideDrawer(){this.mapStore.hideDrawer()},goTo(){const n=`[${this.clickedFeature.id}] ${this.clickedFeature.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t(this.clickedFeature.type==="cave"?"navigateToCave":"navigateToCustomLocation")}: ${n}`,cancel:!0,persistent:!0}).onOk(()=>{const t=at([this.clickedFeature.lng,this.clickedFeature.lat]),e=new j(new ut(t));this.locationStore.startNavigation(e)})},info(n){this.$router.push({name:this.clickedFeature.type==="cave"?"caves-details":"custom-locations-details",params:{id:n}})}},watch:{showBottomDrawer(n,t){this.dialog=n}}},to={class:"q-pa-md q-gutter-sm"},eo={key:0,class:"text-weight-bold"},oo={key:1,class:"text-weight-bold"},no={key:0,class:"text-grey"},io={class:"text-grey"};function ro(n,t,e,o,i,r){return x(),T("div",to,[l(lt,{modelValue:o.dialog,"onUpdate:modelValue":t[2]||(t[2]=a=>o.dialog=a),position:"bottom",onHide:r.hideDrawer,seamless:""},{default:u(()=>[l(st,{style:{width:"350px"}},{default:u(()=>[r.drawerLoading?(x(),I(D,{key:0,class:"row justify-center items-center"},{default:u(()=>[l(ae,{color:"primary",size:"3em",thickness:2})]),_:1})):(x(),T(G,{key:1},[l(D,{class:"row items-center q-pb-none"},{default:u(()=>[r.clickedFeature.type!=="click"?(x(),T("div",eo,"["+g(r.clickedFeature.id)+"] "+g(r.clickedFeature.name),1)):(x(),T("div",oo,g(n.$t("clickInfo"))+":",1)),l(rt),se(l(M,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ze]])]),_:1}),l(D,{class:"row items-center no-wrap"},{default:u(()=>[b("div",null,[r.clickedFeature.type==="cave"?(x(),T("div",no,g(n.$t("length"))+": "+g(r.clickedFeature.length)+" m, "+g(n.$t("depth"))+": "+g(r.clickedFeature.depth)+" m",1)):U("",!0),b("div",io,g(n.$t("lat"))+": "+g(r.clickedFeature.lat)+", "+g(n.$t("lng"))+": "+g(r.clickedFeature.lng),1)]),l(rt),r.clickedFeature.type!=="click"?(x(),I(M,{key:0,flat:"",round:"",icon:"info",onClick:t[0]||(t[0]=a=>r.info(r.clickedFeature.id))})):U("",!0),l(M,{flat:"",round:"",icon:"assist_walker",onClick:t[1]||(t[1]=a=>r.goTo())})]),_:1})],64))]),_:1})]),_:1},8,["modelValue","onHide"])])}var ao=A(Je,[["render",ro]]);const so={setup(){const{dialog:n,notify:t}=St(),e=Rt(),o=ht(),{getShowDialog:i,progress:r,allContent:a,currentContent:s}=ct(e),c=y(!1),h=y("");return{notify:t,offlineDataName:h,offlineStore:e,mapStore:o,getShowDialog:i,selectedItems:y([]),confirmDialog:y(!1),confirmDownloadDialog:n,progress:r,allContent:a,currentContent:s,progressLabel:R(()=>(r.value*100).toFixed(2)+"%"),allProgressLabel:R(()=>s.value+"/"+a.value),inProgress:c}},watch:{getShowDialog(n,t){this.confirmDialog=n}},methods:{async onSubmit(){if(this.offlineDataName.length===0){this.notify({message:this.$t("offlineNameMissing"),color:"red"});return}this.confirmDownloadDialog({title:`${this.$t("confirm")}`,message:`${this.$t("confirmDownloadOfArea")}`,cancel:!0,persistent:!0}).onOk(async()=>{this.inProgress=!0;try{await this.offlineStore.transferData([...this.selectedItems,"cavesLayer"],this.mapStore.getExtent,this.offlineDataName)}catch(n){console.log(n)}finally{this.onReset()}})},onReset(){this.inProgress=!1,this.confirmDialog=!1,this.offlineStore.hideDialog()}}},lo={class:"q-pa-md q-gutter-sm"},co={class:"text-h6"},uo={class:"text-grey-6"},ho={class:"absolute-full flex flex-center"};function fo(n,t,e,o,i,r){return x(),T("div",lo,[l(lt,{modelValue:o.confirmDialog,"onUpdate:modelValue":t[6]||(t[6]=a=>o.confirmDialog=a),noBackdropDismiss:""},{default:u(()=>[l(st,{style:{width:"300px"},class:"q-px-sm q-pb-md"},{default:u(()=>[l(de,{onSubmit:r.onSubmit,onReset:r.onReset,class:"q-gutter-md"},{default:u(()=>[l(D,null,{default:u(()=>[b("div",co,g(n.$t("dataForOffline")),1)]),_:1}),l(D,null,{default:u(()=>[l(le,{disable:o.inProgress,modelValue:o.offlineDataName,"onUpdate:modelValue":t[0]||(t[0]=a=>o.offlineDataName=a),label:n.$t("offlineDataName"),dense:"",rules:[a=>a&&a.length>0||"Please type something"]},null,8,["disable","modelValue","label","rules"])]),_:1}),l(C,{header:""},{default:u(()=>[E(g(n.$t("mapLayers")),1)]),_:1}),l(O,{dense:""},{default:u(()=>[l(F,{avatar:""},{default:u(()=>[l(X,{disable:o.inProgress,modelValue:o.selectedItems,"onUpdate:modelValue":t[1]||(t[1]=a=>o.selectedItems=a),val:"osm",color:"teal"},null,8,["disable","modelValue"])]),_:1}),l(F,null,{default:u(()=>[l(C,null,{default:u(()=>[E(g(n.$t("osmMapLayer")),1)]),_:1}),l(C,{caption:""},{default:u(()=>[E(g(n.$t("osmMapLayerDescription")),1)]),_:1})]),_:1})]),_:1}),l(O,{dense:""},{default:u(()=>[l(F,{avatar:""},{default:u(()=>[l(X,{disable:o.inProgress,modelValue:o.selectedItems,"onUpdate:modelValue":t[2]||(t[2]=a=>o.selectedItems=a),val:"lidar",color:"teal"},null,8,["disable","modelValue"])]),_:1}),l(F,null,{default:u(()=>[l(C,null,{default:u(()=>[E(g(n.$t("lidarMapLayer")),1)]),_:1}),l(C,{caption:""},{default:u(()=>[E(g(n.$t("lidarMapLayerDescription")),1)]),_:1})]),_:1})]),_:1}),l(O,{dense:""},{default:u(()=>[l(F,{avatar:"",top:""},{default:u(()=>[l(X,{disable:o.inProgress,modelValue:o.selectedItems,"onUpdate:modelValue":t[3]||(t[3]=a=>o.selectedItems=a),val:"ortophoto",color:"teal"},null,8,["disable","modelValue"])]),_:1}),l(F,null,{default:u(()=>[l(C,null,{default:u(()=>[E(g(n.$t("orthoMapLayer")),1)]),_:1}),l(C,{caption:""},{default:u(()=>[E(g(n.$t("orthoMapLayerDescription")),1)]),_:1})]),_:1})]),_:1}),l(C,{header:""},{default:u(()=>[E(g(n.$t("caves")),1)]),_:1}),l(O,{dense:""},{default:u(()=>[l(F,{avatar:"",top:""},{default:u(()=>[l(X,{disable:o.inProgress,modelValue:o.selectedItems,"onUpdate:modelValue":t[4]||(t[4]=a=>o.selectedItems=a),val:"caves",color:"teal"},null,8,["disable","modelValue"])]),_:1}),l(F,null,{default:u(()=>[l(C,null,{default:u(()=>[E(g(n.$t("caveData")),1)]),_:1}),l(C,{caption:""},{default:u(()=>[E(g(n.$t("caveDataDescription")),1)]),_:1})]),_:1})]),_:1}),l(C,{header:""},{default:u(()=>[E(g(n.$t("customLocations")),1)]),_:1}),l(O,{dense:""},{default:u(()=>[l(F,{avatar:"",top:""},{default:u(()=>[l(X,{disable:o.inProgress,modelValue:o.selectedItems,"onUpdate:modelValue":t[5]||(t[5]=a=>o.selectedItems=a),val:"customLocations",color:"teal"},null,8,["disable","modelValue"])]),_:1}),l(F,null,{default:u(()=>[l(C,null,{default:u(()=>[E(g(n.$t("customLocationsData")),1)]),_:1}),l(C,{caption:""},{default:u(()=>[E(g(n.$t("customLocationsDataDescription")),1)]),_:1})]),_:1})]),_:1}),o.inProgress?(x(),I(D,{key:0,class:"text-center q-pa-none"},{default:u(()=>[b("p",uo,g(n.$t("fetchingData"))+": "+g(o.allProgressLabel),1),l(fe,{"instant-feedback":!0,size:"50px",value:o.progress,color:"accent",class:"q-mt-sm"},{default:u(()=>[b("div",ho,[l(pe,{color:"white","text-color":"accent",label:o.progressLabel},null,8,["label"])])]),_:1},8,["value"])]),_:1})):U("",!0),l(ce,{align:"center",class:"q-mt-md"},{default:u(()=>[l(M,{disable:o.inProgress,label:n.$t("download"),type:"submit",color:"primary"},null,8,["disable","label"]),l(M,{label:n.$t("cancel"),type:"reset",color:"primary",flat:"",class:"q-ml-sm"},null,8,["label"])]),_:1})]),_:1},8,["onSubmit","onReset"])]),_:1})]),_:1},8,["modelValue"])])}var po=A(so,[["render",fo]]);const mo=ue({name:"IndexPage",components:{PageFullScreen:$e,CartoLayers:me,LocationLayers:Ke,CustomLocationLayers:We,DetailsDrawer:ao,OfflineConfirmDialog:po},setup(){const n=Q(),t=ht(),e=Rt(),o=y([1637531,5766419]),i=y("EPSG:3857"),r=y(8),a=y(!1),s=y([]),c=y(null),h=y(""),d=y("");return t.saveMapRef(d),{locationStore:n,center:o,projection:i,zoom:r,view:h,mapRef:d,markLocations:s,goTo:c,customLocations:a,mapStore:t,offlineStore:e}},data(){if(this.$route.query.lat&&this.$route.query.lng){const n=at([this.$route.query.lng,this.$route.query.lat]),t=new j(new ut(n));this.markLocations=[t],this.center=n,this.zoom=15,this.goTo=this.$route.query.navigate?t:null}return this.customLocations=this.$route.query.customLocation,{currentCenter:this.center,currentZoom:this.zoom,currentResolution:this.resolution,fixedCenter:!1}},computed:{trackLocationIcon(){return this.locationStore.getLocationTracking},navigationActive(){return this.locationStore.getNavigationActive},isCenterFixed(){return this.fixedCenter}},methods:{async onMapClick(n){if(n.coordinate){const t=this.mapRef.map.getFeaturesAtPixel(n.pixel);await this.mapStore.mapClick(n.coordinate,t)}},zoomChanged(n){this.currentZoom=n,this.mapStore.updateExtent(this.mapRef.map.getView().calculateExtent())},trackingClicked(n){this.locationStore.toggleLocationTracking()},myLocationClicked(n){this.center=this.locationStore.getMyLocationCoordinates,this.fixedCenter=!0,this.zoom=this.zoom<15?15:this.currentZoom},resolutionChanged(n){this.currentResolution=n},centerChanged(n){this.view!==""&&(this.currentCenter=n,this.view.getInteracting()?this.fixedCenter=!1:this.fixedCenter&&(this.center=n))},onScreenOrientationChange(){this.mapRef.updateSize()},storeDataForOffline(){this.offlineStore.showDialog()}},watch:{view(n,t){this.locationStore.initialize(n.getProjection()),this.goTo&&this.locationStore.startNavigation(this.goTo)}},mounted(){this.mapRef.map.on("click",async n=>{await this.onMapClick(n)})}});function go(n,t,e,o,i,r){const a=m("ol-view"),s=m("CartoLayers"),c=m("LocationLayers"),h=m("CustomLocationLayers"),d=m("ol-source-vector"),f=m("ol-vector-layer"),p=m("ol-map"),_=m("DetailsDrawer"),v=m("OfflineConfirmDialog"),w=m("PageFullScreen");return x(),I(w,{style:{background:"#eee"}},{default:u(()=>[l(p,{loadTilesWhileAnimating:"",loadTilesWhileInteracting:"",style:{height:"100%"},moveTolerance:5,ref:"mapRef"},{default:u(()=>[l(a,{ref:"view",enableRotation:!1,center:n.center,zoom:n.zoom,projection:n.projection,onZoomChanged:n.zoomChanged,onCenterChanged:n.centerChanged,onResolutionChanged:n.resolutionChanged},null,8,["center","zoom","projection","onZoomChanged","onCenterChanged","onResolutionChanged"]),l(s),l(c,{view:n.view,onCenterChanged:n.centerChanged},null,8,["view","onCenterChanged"]),n.customLocations?(x(),I(h,{key:0})):U("",!0),l(f,null,{default:u(()=>[l(d,{features:n.markLocations},null,8,["features"])]),_:1}),l(Mt,{onResize:n.onScreenOrientationChange},null,8,["onResize"])]),_:1},512),l(tt,{position:"top-right",offset:[18,18]},{default:u(()=>[l(dt,{size:"100px","external-label":"",color:"purple",icon:"layers",direction:"left"},{default:u(()=>[(x(!0),T(G,null,Tt(n.mapStore.getLayers,B=>(x(),I(W,{key:B.name,padding:"3px","label-class":"bg-grey-3 text-grey-8","external-label":"","label-position":"bottom",color:B.active?"red":"primary",onClick:_o=>B.active=!B.active,icon:`img:${B.preview}`,label:B.label},null,8,["color","onClick","icon","label"]))),128))]),_:1})]),_:1}),l(tt,{position:"bottom-left",offset:[18,18]},{default:u(()=>[l(M,{fab:"",icon:n.isCenterFixed?"my_location":"location_searching",color:"accent",onClick:n.myLocationClicked},null,8,["icon","onClick"])]),_:1}),l(tt,{position:"bottom-right",offset:[18,18]},{default:u(()=>[l(dt,{size:"100px","vertical-actions-align":"right",glossy:"",color:"purple",icon:"add",direction:"up"},{default:u(()=>[l(W,{disable:n.currentZoom<14,"label-position":"right",color:"primary",onClick:n.storeDataForOffline,icon:"wifi_off",label:"Offline"},null,8,["disable","onClick"]),l(W,{"label-position":"right",color:"secondary",icon:n.trackLocationIcon?"stop_circle":"play_arrow",label:"Start track",onClick:n.trackingClicked},null,8,["icon","onClick"])]),_:1})]),_:1}),l(_),l(v)]),_:1})}var ko=A(mo,[["render",go]]);export{ko as default};
