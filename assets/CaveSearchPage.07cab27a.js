import{d2 as Q,d4 as S,r as h,cM as i,cN as C,d as a,d9 as r,df as w,dh as y,F as k,d8 as p,dR as d,e9 as N,ek as _,da as m,dc as n,cV as P,el as q,em as F}from"./index.513fe5bd.js";import{a as $,b as v,Q as f}from"./QItem.8f060d88.js";import{Q as M}from"./QSlideItem.d91f396a.js";import{Q as L}from"./format.d2497167.js";import{Q as I}from"./QPullToRefresh.819801df.js";import{u as T}from"./use-quasar.47a30d61.js";const V={name:"CaveSearchPage",setup(){const{dialog:e}=T(),t=S();t.getCaves.length===0&&t.searchForCaves().then(()=>{console.log("caves loaded")});const c=h(t.getQuery),o=h(null),u=h(null);return{confirmDialog:e,store:t,query:c,confirm:h(!1),selectedCave:o,closeSlider:null,confirmRef:u}},computed:{caves(){return this.store.getCaves},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,t;return`[${(e=this.selectedCave)==null?void 0:e.caveNumber}] ${(t=this.selectedCave)==null?void 0:t.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,t){this.executeSearch()}},methods:{goTo({reset:e},t){var o,u;e(),this.selectedCave=t;const c=`[${(o=this.selectedCave)==null?void 0:o.caveNumber}] ${(u=this.selectedCave)==null?void 0:u.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCave")}: ${c}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCave.lat,lng:this.selectedCave.lng,navigate:!0,name:c}})})},caveClick(e){this.$router.push({name:"caves-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng}})},async loadMore(){this.store.incrementPageNumber(),await this.store.searchForCaves()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves();return}await this.store.searchForNearbyCaves()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearbyCaves():await this.store.searchForCaves(),e()}}};function R(e,t,c,o,u,l){return i(),C(k,null,[a(w,{loading:l.searching,modelValue:o.query,"onUpdate:modelValue":t[1]||(t[1]=s=>o.query=s),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCave")},{append:r(()=>[o.query!==""?(i(),p(d,{key:0,name:"close",onClick:t[0]||(t[0]=s=>o.query=""),class:"cursor-pointer"})):(i(),p(d,{key:1,name:"search"}))]),after:r(()=>[a(y,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:l.searchAroundMe,color:l.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),a(I,{onRefresh:l.refresh},{default:r(()=>[a(L,{ref:"scrollTargetRef",class:"scroll"},{default:r(()=>[(i(!0),C(k,null,N(l.caves,(s,b)=>(i(),C("div",{key:b},[a(M,{onLeft:g=>l.goTo(g,s)},{left:r(()=>[a(d,{name:"assist_walker"})]),default:r(()=>[a($,{clickable:"",onClick:g=>l.caveClick(s.caveNumber)},{default:r(()=>[a(v,{avatar:"",top:""},{default:r(()=>[a(_,{icon:"info",color:"primary","text-color":"white"}),a(d,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),a(v,null,{default:r(()=>[a(f,{lines:"1"},{default:r(()=>[m(n(s.caveNumber)+" - "+n(s.name),1)]),_:2},1024),a(f,{caption:""},{default:r(()=>[m(n(e.$t("length"))+": "+n(s.length)+" m, "+n(e.$t("depth"))+": "+n(s.depth)+" m",1)]),_:2},1024),a(f,{caption:""},{default:r(()=>[m(n(s.organization),1)]),_:2},1024),s.distance?(i(),p(f,{key:0,caption:""},{default:r(()=>[m(n(e.$t("distance"))+": "+n(parseInt(s.distance))+" m",1)]),_:2},1024)):P("",!0)]),_:2},1024),a(v,{side:""},{default:r(()=>[a(d,{name:"map",color:"green",size:"lg",onClick:q(g=>l.showOnMapClick(s),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),a(F)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),a(y,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:l.loadMore,disabled:l.totalPages<=l.pageNumber},null,8,["label","onClick","disabled"])],64)}var E=Q(V,[["render",R]]);export{E as default};
