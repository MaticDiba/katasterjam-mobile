import{_ as S,r as h,ag as w,j as l,k as m,d as t,I as s,N as P,P as k,F as L,H as y,ah as c,aK as v,by as z,m as b,J as g,L as i,bz as N,bA as q}from"./index.315eb3dd.js";import{Q as $,c as I,d as C,a as f}from"./format.62b2ae12.js";import{Q as M,a as O}from"./QPullToRefresh.102d278b.js";import{u as T}from"./use-quasar.f252f1be.js";import{u as D}from"./custom-location-store.d8520875.js";import{f as V}from"./date.3d23ecb2.js";import{O as A}from"./OrganizationsList.9df873da.js";const F={name:"CustomLocationSearchPage",components:{OrganizationsList:A},setup(){const{dialog:e}=T(),a=D();a.getCustomLocations.length===0&&a.search().then(()=>{console.log("custom locations loaded")});const u=h(a.getQuery),n=h(null),d=h(null);return{confirmDialog:e,store:a,query:u,confirm:h(!1),selectedCustomLocation:n,closeSlider:null,confirmRef:d,formatDate:V}},computed:{customLocations(){return this.store.getCustomLocations},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,a;return`[${(e=this.selectedCustomLocation)==null?void 0:e.id}] ${(a=this.selectedCustomLocation)==null?void 0:a.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,a){this.executeSearch()}},methods:{goTo({reset:e},a){var n,d;e(),this.selectedCustomLocation=a;const u=`[${(n=this.selectedCustomLocation)==null?void 0:n.id}] ${(d=this.selectedCustomLocation)==null?void 0:d.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCustomLocation")}: ${u}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCustomLocation.lat,lng:this.selectedCustomLocation.lng,navigate:!0,customLocation:!0,name:u}})})},customLocationClick(e){this.$router.push({name:"custom-locations-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng,customLocation:!0}})},async loadMore(){this.store.incrementPageNumber(),await this.store.search()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search();return}await this.store.searchForNearby()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearby():await this.store.search(),e()}}},R={key:0};function B(e,a,u,n,d,o){const Q=w("OrganizationsList");return l(),m(L,null,[t(P,{loading:o.searching,modelValue:n.query,"onUpdate:modelValue":a[1]||(a[1]=r=>n.query=r),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCustomLocation")},{append:s(()=>[n.query!==""?(l(),y(c,{key:0,name:"close",onClick:a[0]||(a[0]=r=>n.query=""),class:"cursor-pointer"})):(l(),y(c,{key:1,name:"search"}))]),after:s(()=>[t(k,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:o.searchAroundMe,color:o.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),t(M,{onRefresh:o.refresh},{default:s(()=>[t($,{ref:"scrollTargetRef",class:"scroll"},{default:s(()=>[(l(!0),m(L,null,v(o.customLocations,(r,_)=>(l(),m("div",{key:_},[t(O,{onLeft:p=>o.goTo(p,r)},{left:s(()=>[t(c,{name:"assist_walker"})]),default:s(()=>[t(I,{clickable:"",onClick:p=>o.customLocationClick(r.id)},{default:s(()=>[t(C,{avatar:"",top:""},{default:s(()=>[t(z,{icon:"info",color:"primary","text-color":"white"}),t(c,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),t(C,null,{default:s(()=>[t(f,{lines:"1"},{default:s(()=>[r.isAuthor?(l(),m("span",R,[t(c,{name:"check"})])):b("",!0),g(" "+i(r.id)+" - "+i(r.name),1)]),_:2},1024),t(f,{caption:""},{default:s(()=>[g(i(e.$t("type"))+": "+i(r.type)+", "+i(e.$t("date"))+": "+i(n.formatDate(r.createdDate)),1)]),_:2},1024),t(f,{caption:""},{default:s(()=>[g(i(e.$t("organizations"))+": ",1),t(Q,{organizations:r.organizations},null,8,["organizations"])]),_:2},1024),r.distance?(l(),y(f,{key:0,caption:""},{default:s(()=>[g(i(e.$t("distance"))+": "+i(parseInt(r.distance))+" m",1)]),_:2},1024)):b("",!0)]),_:2},1024),t(C,{side:""},{default:s(()=>[t(c,{name:"map",color:"green",size:"lg",onClick:N(p=>o.showOnMapClick(r),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),t(q)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),t(k,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var G=S(F,[["render",B]]);export{G as default};
