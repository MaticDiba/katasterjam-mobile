import{_ as S,A as w,r as h,bs as P,am as q,j as l,k as m,d as t,D as o,J as v,L as k,F as L,C,an as c,b3 as z,bo as N,m as b,E as f,H as i,bp as $,bq as M}from"./index.833812ab.js";import{a as O,b as y,Q as g}from"./QItem.5cdc8a91.js";import{Q as D}from"./QSlideItem.2b68f9b0.js";import{Q as F}from"./format.feecb03e.js";import{Q as I}from"./QPullToRefresh.c75f5829.js";import{u as T}from"./use-quasar.aa50d335.js";import{O as V}from"./OrganizationsList.60143ddf.js";const A={name:"CustomLocationSearchPage",components:{OrganizationsList:V},setup(){const{dialog:e}=T(),a=w();a.tryFetchCustomLocationsForOffline().then(()=>{console.log("Custom location list updated")}),a.getCustomLocations.length===0&&a.search().then(()=>{console.log("custom locations loaded")});const u=h(a.getQuery),n=h(null),d=h(null);return{confirmDialog:e,store:a,query:u,confirm:h(!1),selectedCustomLocation:n,closeSlider:null,confirmRef:d,formatDate:P}},computed:{customLocations(){return this.store.getCustomLocations},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,a;return`[${(e=this.selectedCustomLocation)==null?void 0:e.id}] ${(a=this.selectedCustomLocation)==null?void 0:a.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,a){this.executeSearch()}},methods:{goTo({reset:e},a){var n,d;e(),this.selectedCustomLocation=a;const u=`[${(n=this.selectedCustomLocation)==null?void 0:n.id}] ${(d=this.selectedCustomLocation)==null?void 0:d.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCustomLocation")}: ${u}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCustomLocation.lat,lng:this.selectedCustomLocation.lng,navigate:!0,customLocation:!0,name:u}})})},customLocationClick(e){this.$router.push({name:"custom-locations-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng,customLocation:!0}})},async loadMore(){this.store.incrementPageNumber(),await this.store.search()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search();return}await this.store.searchForNearby()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearby():await this.store.search(),e()}}},R={key:0};function B(e,a,u,n,d,s){const Q=q("OrganizationsList");return l(),m(L,null,[t(v,{loading:s.searching,modelValue:n.query,"onUpdate:modelValue":a[1]||(a[1]=r=>n.query=r),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCustomLocation")},{append:o(()=>[n.query!==""?(l(),C(c,{key:0,name:"close",onClick:a[0]||(a[0]=r=>n.query=""),class:"cursor-pointer"})):(l(),C(c,{key:1,name:"search"}))]),after:o(()=>[t(k,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:s.searchAroundMe,color:s.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),t(I,{onRefresh:s.refresh},{default:o(()=>[t(F,{ref:"scrollTargetRef",class:"scroll"},{default:o(()=>[(l(!0),m(L,null,z(s.customLocations,(r,_)=>(l(),m("div",{key:_},[t(D,{onLeft:p=>s.goTo(p,r)},{left:o(()=>[t(c,{name:"assist_walker"})]),default:o(()=>[t(O,{clickable:"",onClick:p=>s.customLocationClick(r.id)},{default:o(()=>[t(y,{avatar:"",top:""},{default:o(()=>[t(N,{icon:"info",color:"primary","text-color":"white"}),t(c,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),t(y,null,{default:o(()=>[t(g,{lines:"1"},{default:o(()=>[r.isAuthor?(l(),m("span",R,[t(c,{name:"check"})])):b("",!0),f(" "+i(r.id)+" - "+i(r.name),1)]),_:2},1024),t(g,{caption:""},{default:o(()=>[f(i(e.$t("type"))+": "+i(r.type)+", "+i(e.$t("date"))+": "+i(n.formatDate(r.createdDate)),1)]),_:2},1024),t(g,{caption:""},{default:o(()=>[f(i(e.$t("organizations"))+": ",1),t(Q,{organizations:r.organizations},null,8,["organizations"])]),_:2},1024),r.distance?(l(),C(g,{key:0,caption:""},{default:o(()=>[f(i(e.$t("distance"))+": "+i(parseInt(r.distance))+" m",1)]),_:2},1024)):b("",!0)]),_:2},1024),t(y,{side:""},{default:o(()=>[t(c,{name:"map",color:"green",size:"lg",onClick:$(p=>s.showOnMapClick(r),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),t(M)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),t(k,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:s.loadMore,disabled:s.totalPages<=s.pageNumber},null,8,["label","onClick","disabled"])],64)}var K=S(A,[["render",B]]);export{K as default};
