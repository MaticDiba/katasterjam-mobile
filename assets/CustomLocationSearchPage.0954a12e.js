import{_ as w,r as g,j as n,k as c,d as t,I as s,N as P,P as _,F as p,H as C,ah as d,aB as L,aD as N,m as k,J as f,L as i,aE as q,aF as v}from"./index.fca8318d.js";import{Q as I,c as $,d as Q,a as y}from"./format.7012f737.js";import{Q as M,a as D}from"./QPullToRefresh.88cab6c1.js";import{u as T}from"./use-quasar.0e972b11.js";import{u as F}from"./custom-location-store.a0c6a814.js";import{f as V}from"./date.3d23ecb2.js";import"./proj.d12bfe9d.js";const z={name:"CustomLocationSearchPage",setup(){const{dialog:e}=T(),a=F();a.getCustomLocations.length===0&&a.search().then(()=>{console.log("custom locations loaded")});const h=g(a.getQuery),l=g(null),m=g(null);return{confirmDialog:e,store:a,query:h,confirm:g(!1),selectedCustomLocation:l,closeSlider:null,confirmRef:m,formatDate:V}},computed:{customLocations(){return this.store.getCustomLocations},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,a;return`[${(e=this.selectedCustomLocation)==null?void 0:e.id}] ${(a=this.selectedCustomLocation)==null?void 0:a.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,a){this.executeSearch()}},methods:{goTo({reset:e},a){var l,m;e(),this.selectedCustomLocation=a;const h=`[${(l=this.selectedCustomLocation)==null?void 0:l.id}] ${(m=this.selectedCustomLocation)==null?void 0:m.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCustomLocation")}: ${h}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCustomLocation.lat,lng:this.selectedCustomLocation.lng,navigate:!0,customLocation:!0,name:h}})})},customLocationClick(e){},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng,customLocation:!0}})},async loadMore(){this.store.incrementPageNumber(),await this.store.search()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search();return}await this.store.searchForNearby()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearby():await this.store.search(),e()}}},B={key:0},R={key:0};function A(e,a,h,l,m,o){return n(),c(p,null,[t(P,{loading:o.searching,modelValue:l.query,"onUpdate:modelValue":a[1]||(a[1]=r=>l.query=r),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCustomLocation")},{append:s(()=>[l.query!==""?(n(),C(d,{key:0,name:"close",onClick:a[0]||(a[0]=r=>l.query=""),class:"cursor-pointer"})):(n(),C(d,{key:1,name:"search"}))]),after:s(()=>[t(_,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:o.searchAroundMe,color:o.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),t(M,{onRefresh:o.refresh},{default:s(()=>[t(I,{ref:"scrollTargetRef",class:"scroll"},{default:s(()=>[(n(!0),c(p,null,L(o.customLocations,(r,S)=>(n(),c("div",{key:S},[t(D,{onLeft:u=>o.goTo(u,r)},{left:s(()=>[t(d,{name:"assist_walker"})]),default:s(()=>[t($,{clickable:"",onClick:u=>o.customLocationClick(r.id)},{default:s(()=>[t(Q,{avatar:"",top:""},{default:s(()=>[t(N,{icon:"info",color:"primary","text-color":"white"}),t(d,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),t(Q,null,{default:s(()=>[t(y,{lines:"1"},{default:s(()=>[r.isAuthor?(n(),c("span",B,[t(d,{name:"check"})])):k("",!0),f(" "+i(r.id)+" - "+i(r.name),1)]),_:2},1024),t(y,{caption:""},{default:s(()=>[f(i(e.$t("type"))+": "+i(r.type)+", "+i(e.$t("date"))+": "+i(l.formatDate(r.createdDate)),1)]),_:2},1024),t(y,{caption:""},{default:s(()=>[f(i(e.$t("organizations"))+": ",1),(n(!0),c(p,null,L(r.organizations,(u,b)=>(n(),c("span",{key:u.id},[f(i(u.name),1),b+1<r.organizations.length?(n(),c("span",R,", ")):k("",!0)]))),128))]),_:2},1024),r.distance?(n(),C(y,{key:0,caption:""},{default:s(()=>[f(i(e.$t("distance"))+": "+i(parseInt(r.distance))+" m",1)]),_:2},1024)):k("",!0)]),_:2},1024),t(Q,{side:""},{default:s(()=>[t(d,{name:"map",color:"green",size:"lg",onClick:q(u=>o.showOnMapClick(r),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),t(v)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),t(_,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var G=w(z,[["render",A]]);export{G as default};
