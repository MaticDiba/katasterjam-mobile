import{i as Qt,W as Q,X as Wt,c as M,g as Zt,x as Jt,h as nt,s as St,_ as N,j as I,H as S,I as y,l as te,aw as ee,am as ne,r as x,ag as d,d as v,k as st,Q as re,M as oe,K as W,L as G,ah as kt,ax as Xt,P as rt,ay as ie,F as ut,az as ae,aA as se,m as Bt,aB as ue,af as ce}from"./index.fca8318d.js";import{t as U,a as yt,s as z,l as ct,b as le,g as he,f as Pt}from"./proj.d12bfe9d.js";import{E as Yt,A as fe,B as Nt,c as lt,G as F,d as $t,S as ht,f as pe,n as ge,e as ve,a as de,i as _e,b as Gt,g as ye,h as H,j as me,P as ft,k as xe,l as Ee,m as w,o as Ot,p as ot,q as Ce,r as we,V as bt,s as Z,t as mt,u as Re,O as Ie,v as xt,w as Le,x as Ae,T as Me,F as it,C as Te}from"./CartoLayers.d6cba2d3.js";import{Q as Fe}from"./QPage.f5ebdd23.js";import{u as Se}from"./custom-location-store.a0c6a814.js";const ke={position:{type:String,default:"bottom-right",validator:r=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(r)},offset:{type:Array,validator:r=>r.length===2},expand:Boolean};function Xe(){const{props:r,proxy:{$q:e}}=Zt(),t=Qt(Wt,Q);if(t===Q)return console.error("QPageSticky needs to be child of QLayout"),Q;const n=M(()=>{const h=r.position;return{top:h.indexOf("top")>-1,right:h.indexOf("right")>-1,bottom:h.indexOf("bottom")>-1,left:h.indexOf("left")>-1,vertical:h==="top"||h==="bottom",horizontal:h==="left"||h==="right"}}),o=M(()=>t.header.offset),i=M(()=>t.right.offset),a=M(()=>t.footer.offset),s=M(()=>t.left.offset),u=M(()=>{let h=0,p=0;const f=n.value,g=e.lang.rtl===!0?-1:1;f.top===!0&&o.value!==0?p=`${o.value}px`:f.bottom===!0&&a.value!==0&&(p=`${-a.value}px`),f.left===!0&&s.value!==0?h=`${g*s.value}px`:f.right===!0&&i.value!==0&&(h=`${-g*i.value}px`);const _={transform:`translate(${h}, ${p})`};return r.offset&&(_.margin=`${r.offset[1]}px ${r.offset[0]}px`),f.vertical===!0?(s.value!==0&&(_[e.lang.rtl===!0?"right":"left"]=`${s.value}px`),i.value!==0&&(_[e.lang.rtl===!0?"left":"right"]=`${i.value}px`)):f.horizontal===!0&&(o.value!==0&&(_.top=`${o.value}px`),a.value!==0&&(_.bottom=`${a.value}px`)),_}),c=M(()=>`q-page-sticky row flex-center fixed-${r.position} q-page-sticky--${r.expand===!0?"expand":"shrink"}`);function l(h){const p=Jt(h.default);return nt("div",{class:c.value,style:u.value},r.expand===!0?p:[nt("div",p)])}return{$layout:t,getStickyContent:l}}var Et=St({name:"QPageSticky",props:ke,setup(r,{slots:e}){const{getStickyContent:t}=Xe();return()=>t(e)}}),pt=63710088e-1;function Be(r,e,t){var n=t||pt,o=U(r[1]),i=U(e[1]),a=(i-o)/2,s=U(e[0]-r[0])/2,u=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(o)*Math.cos(i);return 2*n*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}function J(r,e){for(var t=0,n=0,o=r.length;n<o-1;++n)t+=Be(r[n],r[n+1],e);return t}function at(r,e){var t=e||{},n=t.radius||pt,o=t.projection||"EPSG:3857",i=r.getType();i!=="GeometryCollection"&&(r=r.clone().transform(o,"EPSG:4326"));var a=0,s,u,c,l,h,p;switch(i){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{s=r.getCoordinates(),a=J(s,n);break}case"MultiLineString":case"Polygon":{for(s=r.getCoordinates(),c=0,l=s.length;c<l;++c)a+=J(s[c],n);break}case"MultiPolygon":{for(s=r.getCoordinates(),c=0,l=s.length;c<l;++c)for(u=s[c],h=0,p=u.length;h<p;++h)a+=J(u[h],n);break}case"GeometryCollection":{var f=r.getGeometries();for(c=0,l=f.length;c<l;++c)a+=at(f[c],e);break}default:throw new Error("Unsupported geometry type: "+i)}return a}function Pe(r,e,t,n){var o=n||pt,i=U(r[1]),a=U(r[0]),s=e/o,u=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(t)),c=a+Math.atan2(Math.sin(t)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(u));return[yt(c),yt(u)]}var Y={ADD:"add",REMOVE:"remove"},Dt=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ct={LENGTH:"length"},q=function(r){Dt(e,r);function e(t,n,o){var i=r.call(this,t)||this;return i.element=n,i.index=o,i}return e}(Yt),Ye=function(r){Dt(e,r);function e(t,n){var o=r.call(this)||this;o.on,o.once,o.un;var i=n||{};if(o.unique_=!!i.unique,o.array_=t||[],o.unique_)for(var a=0,s=o.array_.length;a<s;++a)o.assertUnique_(o.array_[a],a);return o.updateLength_(),o}return e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var n=0,o=t.length;n<o;++n)this.push(t[n]);return this},e.prototype.forEach=function(t){for(var n=this.array_,o=0,i=n.length;o<i;++o)t(n[o],o,n)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(Ct.LENGTH)},e.prototype.insertAt=function(t,n){this.unique_&&this.assertUnique_(n),this.array_.splice(t,0,n),this.updateLength_(),this.dispatchEvent(new q(Y.ADD,n,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var n=this.getLength();return this.insertAt(n,t),this.getLength()},e.prototype.remove=function(t){for(var n=this.array_,o=0,i=n.length;o<i;++o)if(n[o]===t)return this.removeAt(o)},e.prototype.removeAt=function(t){var n=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new q(Y.REMOVE,n,t)),n},e.prototype.setAt=function(t,n){var o=this.getLength();if(t<o){this.unique_&&this.assertUnique_(n,t);var i=this.array_[t];this.array_[t]=n,this.dispatchEvent(new q(Y.REMOVE,i,t)),this.dispatchEvent(new q(Y.ADD,n,t))}else{for(var a=o;a<t;++a)this.insertAt(a,void 0);this.insertAt(t,n)}},e.prototype.updateLength_=function(){this.set(Ct.LENGTH,this.array_.length)},e.prototype.assertUnique_=function(t,n){for(var o=0,i=this.array_.length;o<i;++o)if(this.array_[o]===t&&o!==n)throw new fe(58)},e}(Nt),Ne=Ye;function wt(r,e,t,n,o,i,a){var s=r[e],u=r[e+1],c=r[t]-s,l=r[t+1]-u,h;if(c===0&&l===0)h=e;else{var p=((o-s)*c+(i-u)*l)/(c*c+l*l);if(p>1)h=t;else if(p>0){for(var f=0;f<n;++f)a[f]=ct(r[e+f],r[t+f],p);a.length=n;return}else h=e}for(var f=0;f<n;++f)a[f]=r[h+f];a.length=n}function gt(r,e,t,n,o){var i=r[e],a=r[e+1];for(e+=n;e<t;e+=n){var s=r[e],u=r[e+1],c=z(i,a,s,u);c>o&&(o=c),i=s,a=u}return o}function $e(r,e,t,n,o){for(var i=0,a=t.length;i<a;++i){var s=t[i];o=gt(r,e,s,n,o),e=s}return o}function vt(r,e,t,n,o,i,a,s,u,c,l){if(e==t)return c;var h,p;if(o===0)if(p=z(a,s,r[e],r[e+1]),p<c){for(h=0;h<n;++h)u[h]=r[e+h];return u.length=n,p}else return c;for(var f=l||[NaN,NaN],g=e+n;g<t;)if(wt(r,g-n,g,n,a,s,f),p=z(a,s,f[0],f[1]),p<c){for(c=p,h=0;h<n;++h)u[h]=f[h];u.length=n,g+=n}else g+=n*Math.max((Math.sqrt(p)-Math.sqrt(c))/o|0,1);if(i&&(wt(r,t-n,e,n,a,s,f),p=z(a,s,f[0],f[1]),p<c)){for(c=p,h=0;h<n;++h)u[h]=f[h];u.length=n}return c}function Ge(r,e,t,n,o,i,a,s,u,c,l){for(var h=l||[NaN,NaN],p=0,f=t.length;p<f;++p){var g=t[p];c=vt(r,e,g,n,o,i,a,s,u,c,h),e=g}return c}function Ut(r,e,t,n,o,i,a){var s=(t-e)/n;if(s<3){for(;e<t;e+=n)i[a++]=r[e],i[a++]=r[e+1];return a}var u=new Array(s);u[0]=1,u[s-1]=1;for(var c=[e,t-n],l=0;c.length>0;){for(var h=c.pop(),p=c.pop(),f=0,g=r[p],_=r[p+1],E=r[h],k=r[h+1],m=p+n;m<h;m+=n){var R=r[m],L=r[m+1],$=le(R,L,g,_,E,k);$>f&&(l=m,f=$)}f>o&&(u[(l-e)/n]=1,p+n<l&&c.push(p,l),l+n<h&&c.push(l,h))}for(var m=0;m<s;++m)u[m]&&(i[a++]=r[e+m*n],i[a++]=r[e+m*n+1]);return a}function X(r,e){return e*Math.round(r/e)}function Oe(r,e,t,n,o,i,a){if(e==t)return a;var s=X(r[e],o),u=X(r[e+1],o);e+=n,i[a++]=s,i[a++]=u;var c,l;do if(c=X(r[e],o),l=X(r[e+1],o),e+=n,e==t)return i[a++]=c,i[a++]=l,a;while(c==s&&l==u);for(;e<t;){var h=X(r[e],o),p=X(r[e+1],o);if(e+=n,!(h==c&&p==l)){var f=c-s,g=l-u,_=h-s,E=p-u;if(f*E==g*_&&(f<0&&_<f||f==_||f>0&&_>f)&&(g<0&&E<g||g==E||g>0&&E>g)){c=h,l=p;continue}i[a++]=c,i[a++]=l,s=c,u=l,c=h,l=p}}return i[a++]=c,i[a++]=l,a}function be(r,e,t,n,o,i,a,s){for(var u=0,c=t.length;u<c;++u){var l=t[u];a=Oe(r,e,l,n,o,i,a),s.push(a),e=l}return a}function dt(r,e,t,n,o){for(var i=o!==void 0?o:[],a=0,s=e;s<t;s+=n)i[a++]=r.slice(s,s+n);return i.length=a,i}function De(r,e,t,n,o){for(var i=o!==void 0?o:[],a=0,s=0,u=t.length;s<u;++s){var c=t[s];i[a++]=dt(r,e,c,n,i[a]),e=c}return i.length=a,i}function qt(r,e,t,n){for(var o=0,i=r[t-n],a=r[t-n+1];e<t;e+=n){var s=r[e],u=r[e+1];o+=a*s-i*u,i=s,a=u}return o/2}function Ue(r,e,t,n){for(var o=0,i=0,a=t.length;i<a;++i){var s=t[i];o+=qt(r,e,s,n),e=s}return o}var qe=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),je=function(r){qe(e,r);function e(t,n){var o=r.call(this)||this;return o.maxDelta_=-1,o.maxDeltaRevision_=-1,n!==void 0&&!Array.isArray(t[0])?o.setFlatCoordinates(n,t):o.setCoordinates(t,n),o}return e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,n,o,i){return i<lt(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,n,o,i))},e.prototype.getArea=function(){return qt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return dt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=Ut(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,F.XY)},e.prototype.getType=function(){return"LinearRing"},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,n){this.setLayout(n,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$t(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ht),Rt=je;function Ve(r,e,t,n,o){var i=pe(o,function(a){return!T(r,e,t,n,a[0],a[1])});return!i}function T(r,e,t,n,o,i){for(var a=0,s=r[t-n],u=r[t-n+1];e<t;e+=n){var c=r[e],l=r[e+1];u<=i?l>i&&(c-s)*(i-u)-(o-s)*(l-u)>0&&a++:l<=i&&(c-s)*(i-u)-(o-s)*(l-u)<0&&a--,s=c,u=l}return a!==0}function jt(r,e,t,n,o,i){if(t.length===0||!T(r,e,t[0],n,o,i))return!1;for(var a=1,s=t.length;a<s;++a)if(T(r,t[a-1],t[a],n,o,i))return!1;return!0}function ze(r,e,t,n,o,i,a){for(var s,u,c,l,h,p,f,g=o[i+1],_=[],E=0,k=t.length;E<k;++E){var m=t[E];for(l=r[m-n],p=r[m-n+1],s=e;s<m;s+=n)h=r[s],f=r[s+1],(g<=p&&f<=g||p<=g&&g<=f)&&(c=(g-p)/(f-p)*(h-l)+l,_.push(c)),l=h,p=f}var R=NaN,L=-1/0;for(_.sort(ge),l=_[0],s=1,u=_.length;s<u;++s){h=_[s];var $=Math.abs(h-l);$>L&&(c=(l+h)/2,jt(r,e,t,n,c,g)&&(R=c,L=$)),l=h}return isNaN(R)&&(R=o[i]),a?(a.push(R,g,L),a):[R,g,L]}function Vt(r,e,t,n,o){var i;for(e+=n;e<t;e+=n)if(i=o(r.slice(e-n,e),r.slice(e,e+n)),i)return i;return!1}function _t(r,e,t,n,o){var i=ve(de(),r,e,t,n);return _e(o,i)?Gt(o,i)||i[0]>=o[0]&&i[2]<=o[2]||i[1]>=o[1]&&i[3]<=o[3]?!0:Vt(r,e,t,n,function(a,s){return ye(o,a,s)}):!1}function He(r,e,t,n,o){return!!(_t(r,e,t,n,o)||T(r,e,t,n,o[0],o[1])||T(r,e,t,n,o[0],o[3])||T(r,e,t,n,o[2],o[1])||T(r,e,t,n,o[2],o[3]))}function Ke(r,e,t,n,o){if(!He(r,e,t[0],n,o))return!1;if(t.length===1)return!0;for(var i=1,a=t.length;i<a;++i)if(Ve(r,t[i-1],t[i],n,o)&&!_t(r,t[i-1],t[i],n,o))return!1;return!0}function Qe(r,e,t,n){for(;e<t-n;){for(var o=0;o<n;++o){var i=r[e+o];r[e+o]=r[t-n+o],r[t-n+o]=i}e+=n,t-=n}}function zt(r,e,t,n){for(var o=0,i=r[t-n],a=r[t-n+1];e<t;e+=n){var s=r[e],u=r[e+1];o+=(s-i)*(u+a),i=s,a=u}return o===0?void 0:o>0}function We(r,e,t,n,o){for(var i=o!==void 0?o:!1,a=0,s=t.length;a<s;++a){var u=t[a],c=zt(r,e,u,n);if(a===0){if(i&&c||!i&&!c)return!1}else if(i&&!c||!i&&c)return!1;e=u}return!0}function It(r,e,t,n,o){for(var i=o!==void 0?o:!1,a=0,s=t.length;a<s;++a){var u=t[a],c=zt(r,e,u,n),l=a===0?i&&c||!i&&!c:i&&!c||!i&&c;l&&Qe(r,e,u,n),e=u}return e}var Ze=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Je=function(r){Ze(e,r);function e(t,n,o){var i=r.call(this)||this;return i.ends_=[],i.flatInteriorPointRevision_=-1,i.flatInteriorPoint_=null,i.maxDelta_=-1,i.maxDeltaRevision_=-1,i.orientedRevision_=-1,i.orientedFlatCoordinates_=null,n!==void 0&&o?(i.setFlatCoordinates(n,t),i.ends_=o):i.setCoordinates(t,n),i}return e.prototype.appendLinearRing=function(t){this.flatCoordinates?H(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,n,o,i){return i<lt(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($e(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ge(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,n,o,i))},e.prototype.containsXY=function(t,n){return jt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,n)},e.prototype.getArea=function(){return Ue(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var n;return t!==void 0?(n=this.getOrientedFlatCoordinates().slice(),It(n,0,this.ends_,this.stride,t)):n=this.flatCoordinates,De(n,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=me(this.getExtent());this.flatInteriorPoint_=ze(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new ft(this.getFlatInteriorPoint(),F.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new Rt(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,n=this.flatCoordinates,o=this.ends_,i=[],a=0,s=0,u=o.length;s<u;++s){var c=o[s],l=new Rt(n.slice(a,c),t);i.push(l),a=c}return i},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;We(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=It(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],o=[];return n.length=be(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),n,0,o),new e(n,F.XY,o)},e.prototype.getType=function(){return"Polygon"},e.prototype.intersectsExtent=function(t){return Ke(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,n){this.setLayout(n,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var o=xe(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=o.length===0?0:o[o.length-1],this.changed()},e}(ht);function tn(r,e,t,n){for(var o=t||32,i=[],a=0;a<o;++a)H(i,Pe(r,e,2*Math.PI*a/o,n));return i.push(i[0],i[1]),new Je(i,F.XY,[i.length])}function en(r,e,t,n,o,i,a){var s,u,c=(t-e)/n;if(c===1)s=e;else if(c===2)s=e,u=o;else if(c!==0){for(var l=r[e],h=r[e+1],p=0,f=[0],g=e+n;g<t;g+=n){var _=r[g],E=r[g+1];p+=Math.sqrt((_-l)*(_-l)+(E-h)*(E-h)),f.push(p),l=_,h=E}var k=o*p,m=Ee(f,k);m<0?(u=(k-f[-m-2])/(f[-m-1]-f[-m-2]),s=e+(-m-2)*n):s=e+m*n}for(var R=a>1?a:2,L=i||new Array(R),g=0;g<R;++g)L[g]=s===void 0?NaN:u===void 0?r[s+g]:ct(r[s+g],r[s+n+g],u);return L}function nn(r,e,t,n,o,i){if(t==e)return null;var a;if(o<r[e+n-1])return i?(a=r.slice(e,e+n),a[n-1]=o,a):null;if(r[t-1]<o)return i?(a=r.slice(t-n,t),a[n-1]=o,a):null;if(o==r[e+n-1])return r.slice(e,e+n);for(var s=e/n,u=t/n;s<u;){var c=s+u>>1;o<r[(c+1)*n-1]?u=c:s=c+1}var l=r[s*n-1];if(o==l)return r.slice((s-1)*n,(s-1)*n+n);var h=r[(s+1)*n-1],p=(o-l)/(h-l);a=[];for(var f=0;f<n-1;++f)a.push(ct(r[(s-1)*n+f],r[s*n+f],p));return a.push(o),a}function rn(r,e,t,n){for(var o=r[e],i=r[e+1],a=0,s=e+n;s<t;s+=n){var u=r[s],c=r[s+1];a+=Math.sqrt((u-o)*(u-o)+(c-i)*(c-i)),o=u,i=c}return a}var on=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),an=function(r){on(e,r);function e(t,n){var o=r.call(this)||this;return o.flatMidpoint_=null,o.flatMidpointRevision_=-1,o.maxDelta_=-1,o.maxDeltaRevision_=-1,n!==void 0&&!Array.isArray(t[0])?o.setFlatCoordinates(n,t):o.setCoordinates(t,n),o}return e.prototype.appendCoordinate=function(t){this.flatCoordinates?H(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,n,o,i){return i<lt(this.getExtent(),t,n)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,n,o,i))},e.prototype.forEachSegment=function(t){return Vt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,n){if(this.layout!=F.XYM&&this.layout!=F.XYZM)return null;var o=n!==void 0?n:!1;return nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,o)},e.prototype.getCoordinates=function(){return dt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,n){return en(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,this.stride)},e.prototype.getLength=function(){return rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=Ut(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,F.XY)},e.prototype.getType=function(){return"LineString"},e.prototype.intersectsExtent=function(t){return _t(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,n){this.setLayout(n,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$t(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ht),Lt=an;function sn(r,e,t,n,o){Ht(r,e,t||0,n||r.length-1,o||un)}function Ht(r,e,t,n,o){for(;n>t;){if(n-t>600){var i=n-t+1,a=e-t+1,s=Math.log(i),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(i-u)/i)*(a-i/2<0?-1:1),l=Math.max(t,Math.floor(e-a*u/i+c)),h=Math.min(n,Math.floor(e+(i-a)*u/i+c));Ht(r,e,l,h,o)}var p=r[e],f=t,g=n;for(O(r,t,e),o(r[n],p)>0&&O(r,t,n);f<g;){for(O(r,f,g),f++,g--;o(r[f],p)<0;)f++;for(;o(r[g],p)>0;)g--}o(r[t],p)===0?O(r,t,g):(g++,O(r,g,n)),g<=e&&(t=g+1),e<=g&&(n=g-1)}}function O(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function un(r,e){return r<e?-1:r>e?1:0}class cn{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!V(e,t))return n;const o=this.toBBox,i=[];for(;t;){for(let a=0;a<t.children.length;a++){const s=t.children[a],u=t.leaf?o(s):s;V(e,u)&&(t.leaf?n.push(s):et(e,u)?this._all(s,n):i.push(s))}t=i.pop()}return n}collides(e){let t=this.data;if(!V(e,t))return!1;const n=[];for(;t;){for(let o=0;o<t.children.length;o++){const i=t.children[o],a=t.leaf?this.toBBox(i):i;if(V(e,a)){if(t.leaf||et(e,a))return!0;n.push(i)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=P([]),this}remove(e,t){if(!e)return this;let n=this.data;const o=this.toBBox(e),i=[],a=[];let s,u,c;for(;n||i.length;){if(n||(n=i.pop(),u=i[i.length-1],s=a.pop(),c=!0),n.leaf){const l=ln(e,n.children,t);if(l!==-1)return n.children.splice(l,1),i.push(n),this._condense(i),this}!c&&!n.leaf&&et(n,o)?(i.push(n),a.push(s),s=0,u=n,n=n.children[0]):u?(s++,n=u.children[s],c=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,o){const i=n-t+1;let a=this._maxEntries,s;if(i<=a)return s=P(e.slice(t,n+1)),B(s,this.toBBox),s;o||(o=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,o-1))),s=P([]),s.leaf=!1,s.height=o;const u=Math.ceil(i/a),c=u*Math.ceil(Math.sqrt(a));At(e,t,n,c,this.compareMinX);for(let l=t;l<=n;l+=c){const h=Math.min(l+c-1,n);At(e,l,h,u,this.compareMinY);for(let p=l;p<=h;p+=u){const f=Math.min(p+u-1,h);s.children.push(this._build(e,p,f,o-1))}}return B(s,this.toBBox),s}_chooseSubtree(e,t,n,o){for(;o.push(t),!(t.leaf||o.length-1===n);){let i=1/0,a=1/0,s;for(let u=0;u<t.children.length;u++){const c=t.children[u],l=tt(c),h=pn(e,c)-l;h<a?(a=h,i=l<i?l:i,s=c):h===a&&l<i&&(i=l,s=c)}t=s||t.children[0]}return t}_insert(e,t,n){const o=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(o,this.data,t,i);for(a.children.push(e),D(a,o);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(o,i,t)}_split(e,t){const n=e[t],o=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,o);const a=this._chooseSplitIndex(n,i,o),s=P(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,B(n,this.toBBox),B(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)}_splitRoot(e,t){this.data=P([e,t]),this.data.height=e.height+1,this.data.leaf=!1,B(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let o,i=1/0,a=1/0;for(let s=t;s<=n-t;s++){const u=b(e,0,s,this.toBBox),c=b(e,s,n,this.toBBox),l=gn(u,c),h=tt(u)+tt(c);l<i?(i=l,o=s,a=h<a?h:a):l===i&&h<a&&(a=h,o=s)}return o||n-t}_chooseSplitAxis(e,t,n){const o=e.leaf?this.compareMinX:hn,i=e.leaf?this.compareMinY:fn,a=this._allDistMargin(e,t,n,o),s=this._allDistMargin(e,t,n,i);a<s&&e.children.sort(o)}_allDistMargin(e,t,n,o){e.children.sort(o);const i=this.toBBox,a=b(e,0,t,i),s=b(e,n-t,n,i);let u=j(a)+j(s);for(let c=t;c<n-t;c++){const l=e.children[c];D(a,e.leaf?i(l):l),u+=j(a)}for(let c=n-t-1;c>=t;c--){const l=e.children[c];D(s,e.leaf?i(l):l),u+=j(s)}return u}_adjustParentBBoxes(e,t,n){for(let o=n;o>=0;o--)D(t[o],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():B(e[t],this.toBBox)}}function ln(r,e,t){if(!t)return e.indexOf(r);for(let n=0;n<e.length;n++)if(t(r,e[n]))return n;return-1}function B(r,e){b(r,0,r.children.length,e,r)}function b(r,e,t,n,o){o||(o=P(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i=e;i<t;i++){const a=r.children[i];D(o,r.leaf?n(a):a)}return o}function D(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function hn(r,e){return r.minX-e.minX}function fn(r,e){return r.minY-e.minY}function tt(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function j(r){return r.maxX-r.minX+(r.maxY-r.minY)}function pn(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function gn(r,e){const t=Math.max(r.minX,e.minX),n=Math.max(r.minY,e.minY),o=Math.min(r.maxX,e.maxX),i=Math.min(r.maxY,e.maxY);return Math.max(0,o-t)*Math.max(0,i-n)}function et(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function V(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function P(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function At(r,e,t,n,o){const i=[e,t];for(;i.length;){if(t=i.pop(),e=i.pop(),t-e<=n)continue;const a=e+Math.ceil((t-e)/n/2)*n;sn(r,a,e,t,o),i.push(e,a,a,t)}}var vn=function(){function r(e){this.rbush_=new cn(e),this.items_={}}return r.prototype.insert=function(e,t){var n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[w(t)]=n},r.prototype.load=function(e,t){for(var n=new Array(t.length),o=0,i=t.length;o<i;o++){var a=e[o],s=t[o],u={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};n[o]=u,this.items_[w(s)]=u}this.rbush_.load(n)},r.prototype.remove=function(e){var t=w(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null},r.prototype.update=function(e,t){var n=this.items_[w(t)],o=[n.minX,n.minY,n.maxX,n.maxY];Ot(o,e)||(this.remove(t),this.insert(e,t))},r.prototype.getAll=function(){var e=this.rbush_.all();return e.map(function(t){return t.value})},r.prototype.getInExtent=function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},n=this.rbush_.search(t);return n.map(function(o){return o.value})},r.prototype.forEach=function(e){return this.forEach_(this.getAll(),e)},r.prototype.forEachInExtent=function(e,t){return this.forEach_(this.getInExtent(e),t)},r.prototype.forEach_=function(e,t){for(var n,o=0,i=e.length;o<i;o++)if(n=t(e[o]),n)return n;return n},r.prototype.isEmpty=function(){return ot(this.items_)},r.prototype.clear=function(){this.rbush_.clear(),this.items_={}},r.prototype.getExtent=function(e){var t=this.rbush_.toJSON();return Ce(t.minX,t.minY,t.maxX,t.maxY,e)},r.prototype.concat=function(e){this.rbush_.load(e.rbush_.all());for(var t in e.items_)this.items_[t]=e.items_[t]},r}(),Mt=vn,dn=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),_n=function(r){dn(e,r);function e(t){var n=r.call(this)||this;n.projection=he(t.projection),n.attributions_=Tt(t.attributions),n.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,n.loading=!1,n.state_=t.state!==void 0?t.state:"ready",n.wrapX_=t.wrapX!==void 0?t.wrapX:!1,n.interpolate_=!!t.interpolate,n.viewResolver=null,n.viewRejector=null;var o=n;return n.viewPromise_=new Promise(function(i,a){o.viewResolver=i,o.viewRejector=a}),n}return e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return we()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getInterpolate=function(){return this.interpolate_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=Tt(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(Nt);function Tt(r){return r?Array.isArray(r)?function(e){return r}:typeof r=="function"?r:function(e){return[r]}:null}var yn=_n,C={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function mn(r,e){return[[-1/0,-1/0,1/0,1/0]]}var xn=!1;function En(r,e,t,n,o,i,a){var s=new XMLHttpRequest;s.open("GET",typeof r=="function"?r(t,n,o):r,!0),e.getType()=="arraybuffer"&&(s.responseType="arraybuffer"),s.withCredentials=xn,s.onload=function(u){if(!s.status||s.status>=200&&s.status<300){var c=e.getType(),l=void 0;c=="json"||c=="text"?l=s.responseText:c=="xml"?(l=s.responseXML,l||(l=new DOMParser().parseFromString(s.responseText,"application/xml"))):c=="arraybuffer"&&(l=s.response),l?i(e.readFeatures(l,{extent:t,featureProjection:o}),e.readProjection(l)):a()}else a()},s.onerror=a,s.send()}function Ft(r,e){return function(t,n,o,i,a){var s=this;En(r,e,t,n,o,function(u,c){s.addFeatures(u),i!==void 0&&i(u)},a||bt)}}var Kt=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),A=function(r){Kt(e,r);function e(t,n,o){var i=r.call(this,t)||this;return i.feature=n,i.features=o,i}return e}(Yt),Cn=function(r){Kt(e,r);function e(t){var n=this,o=t||{};n=r.call(this,{attributions:o.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:o.wrapX!==void 0?o.wrapX:!0})||this,n.on,n.once,n.un,n.loader_=bt,n.format_=o.format,n.overlaps_=o.overlaps===void 0?!0:o.overlaps,n.url_=o.url,o.loader!==void 0?n.loader_=o.loader:n.url_!==void 0&&(Z(n.format_,7),n.loader_=Ft(n.url_,n.format_)),n.strategy_=o.strategy!==void 0?o.strategy:mn;var i=o.useSpatialIndex!==void 0?o.useSpatialIndex:!0;n.featuresRtree_=i?new Mt:null,n.loadedExtentsRtree_=new Mt,n.loadingExtentsCount_=0,n.nullGeometryFeatures_={},n.idIndex_={},n.uidIndex_={},n.featureChangeKeys_={},n.featuresCollection_=null;var a,s;return Array.isArray(o.features)?s=o.features:o.features&&(a=o.features,s=a.getArray()),!i&&a===void 0&&(a=new Ne(s)),s!==void 0&&n.addFeaturesInternal(s),a!==void 0&&n.bindFeaturesCollection_(a),n}return e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var n=w(t);if(!this.addToIndex_(n,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(n,t);var o=t.getGeometry();if(o){var i=o.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[n]=t;this.dispatchEvent(new A(C.ADDFEATURE,t))},e.prototype.setupChangeEvents_=function(t,n){this.featureChangeKeys_[t]=[mt(n,Re.CHANGE,this.handleFeatureChange_,this),mt(n,Ie.PROPERTYCHANGE,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,n){var o=!0,i=n.getId();return i!==void 0&&(i.toString()in this.idIndex_?o=!1:this.idIndex_[i.toString()]=n),o&&(Z(!(t in this.uidIndex_),30),this.uidIndex_[t]=n),o},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var n=[],o=[],i=[],a=0,s=t.length;a<s;a++){var u=t[a],c=w(u);this.addToIndex_(c,u)&&o.push(u)}for(var a=0,l=o.length;a<l;a++){var u=o[a],c=w(u);this.setupChangeEvents_(c,u);var h=u.getGeometry();if(h){var p=h.getExtent();n.push(p),i.push(u)}else this.nullGeometryFeatures_[c]=u}if(this.featuresRtree_&&this.featuresRtree_.load(n,i),this.hasListener(C.ADDFEATURE))for(var a=0,f=o.length;a<f;a++)this.dispatchEvent(new A(C.ADDFEATURE,o[a]))},e.prototype.bindFeaturesCollection_=function(t){var n=!1;this.addEventListener(C.ADDFEATURE,function(o){n||(n=!0,t.push(o.feature),n=!1)}),this.addEventListener(C.REMOVEFEATURE,function(o){n||(n=!0,t.remove(o.feature),n=!1)}),t.addEventListener(Y.ADD,function(o){n||(n=!0,this.addFeature(o.element),n=!1)}.bind(this)),t.addEventListener(Y.REMOVE,function(o){n||(n=!0,this.removeFeature(o.element),n=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var n in this.featureChangeKeys_){var o=this.featureChangeKeys_[n];o.forEach(xt)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var i=function(u){this.removeFeatureInternal(u)}.bind(this);this.featuresRtree_.forEach(i);for(var a in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[a])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var s=new A(C.CLEAR);this.dispatchEvent(s),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,n){var o=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(o,function(i){var a=i.getGeometry();if(a.intersectsCoordinate(t))return n(i)})},e.prototype.forEachFeatureInExtent=function(t,n){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,n);this.featuresCollection_&&this.featuresCollection_.forEach(n)},e.prototype.forEachFeatureIntersectingExtent=function(t,n){return this.forEachFeatureInExtent(t,function(o){var i=o.getGeometry();if(i.intersectsExtent(t)){var a=n(o);if(a)return a}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),ot(this.nullGeometryFeatures_)||H(t,Le(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var n=[];return this.forEachFeatureAtCoordinateDirect(t,function(o){n.push(o)}),n},e.prototype.getFeaturesInExtent=function(t,n){var o=this;if(this.featuresRtree_){var i=n&&n.canWrapX()&&this.getWrapX();if(!i)return this.featuresRtree_.getInExtent(t);var a=Ae(t,n);return[].concat.apply([],a.map(function(s){return o.featuresRtree_.getInExtent(s)}))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,n){var o=t[0],i=t[1],a=null,s=[NaN,NaN],u=1/0,c=[-1/0,-1/0,1/0,1/0],l=n||Me;return this.featuresRtree_.forEachInExtent(c,function(h){if(l(h)){var p=h.getGeometry(),f=u;if(u=p.closestPointXY(o,i,s,u),u<f){a=h;var g=Math.sqrt(u);c[0]=o-g,c[1]=i-g,c[2]=o+g,c[3]=i+g}}}),a},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var n=this.idIndex_[t.toString()];return n!==void 0?n:null},e.prototype.getFeatureByUid=function(t){var n=this.uidIndex_[t];return n!==void 0?n:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var n=t.target,o=w(n),i=n.getGeometry();if(!i)o in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(n),this.nullGeometryFeatures_[o]=n);else{var a=i.getExtent();o in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[o],this.featuresRtree_&&this.featuresRtree_.insert(a,n)):this.featuresRtree_&&this.featuresRtree_.update(a,n)}var s=n.getId();if(s!==void 0){var u=s.toString();this.idIndex_[u]!==n&&(this.removeFromIdIndex_(n),this.idIndex_[u]=n)}else this.removeFromIdIndex_(n),this.uidIndex_[o]=n;this.changed(),this.dispatchEvent(new A(C.CHANGEFEATURE,n))},e.prototype.hasFeature=function(t){var n=t.getId();return n!==void 0?n in this.idIndex_:w(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ot(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},e.prototype.loadFeatures=function(t,n,o){for(var i=this.loadedExtentsRtree_,a=this.strategy_(t,n,o),s=function(h,p){var f=a[h],g=i.forEachInExtent(f,function(_){return Gt(_.extent,f)});g||(++u.loadingExtentsCount_,u.dispatchEvent(new A(C.FEATURESLOADSTART)),u.loader_.call(u,f,n,o,function(_){--this.loadingExtentsCount_,this.dispatchEvent(new A(C.FEATURESLOADEND,void 0,_))}.bind(u),function(){--this.loadingExtentsCount_,this.dispatchEvent(new A(C.FEATURESLOADERROR))}.bind(u)),i.insert(f,{extent:f.slice()}))},u=this,c=0,l=a.length;c<l;++c)s(c);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),r.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var n=this.loadedExtentsRtree_,o;n.forEachInExtent(t,function(i){if(Ot(i.extent,t))return o=i,!0}),o&&n.remove(o)},e.prototype.removeFeature=function(t){if(!!t){var n=w(t);n in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[n]:this.featuresRtree_&&this.featuresRtree_.remove(t);var o=this.removeFeatureInternal(t);o&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var n=w(t),o=this.featureChangeKeys_[n];if(!!o){o.forEach(xt),delete this.featureChangeKeys_[n];var i=t.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[n],this.dispatchEvent(new A(C.REMOVEFEATURE,t)),t}},e.prototype.removeFromIdIndex_=function(t){var n=!1;for(var o in this.idIndex_)if(this.idIndex_[o]===t){delete this.idIndex_[o],n=!0;break}return n},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){Z(this.format_,7),this.url_=t,this.setLoader(Ft(t,this.format_))},e}(yn),wn=Cn;const Rn={name:"PageFullScreen",methods:{tweak(){return{height:this.$q.screen.height-50+"px"}},myTweak(r){r||(r=0);const e=this.$q.platform.is.cordova?`calc(100vh - ${r}px)`:window.innerHeight-r+"px";return this.$store.state.windowSize=e,{minHeight:e}}}};function In(r,e,t,n,o,i){return I(),S(Fe,{"style-fn":i.tweak,class:"scroll-y fhpadd"},{default:y(()=>[te(r.$slots,"default")]),_:3},8,["style-fn"])}var Ln=N(Rn,[["render",In]]);const K=ee("location",{state:()=>({foregroundLocationActivated:!1,isCordova:ne.is.cordova,projection:null,rotation:45,watchId:null,locationTracking:!1,navigationActive:!1,myLocation:{},myTrack:[],navigateTo:[]}),getters:{getProjection(r){return r.projection},getRotation(r){return r.rotation},getLocationTracking(r){return r.locationTracking},getNavigationActive(r){return r.navigationActive},getMyLocation(r){return r.myLocation},getMyLocationAccuracy(r){return r.myLocation.accuracy},getMyLocationCoordinates(r){return r.myLocation.coordinates},getMyTrack(r){return r.myTrack},getNavigateTo(r){return r.navigateTo},foregroundNotNeeded(r){return!r.locationTracking&&!r.navigationActive}},actions:{initialize(r){this.projection=r,this.watchId&&navigator.compass.clearWatch(this.watchId),this.isCordova&&(window.BackgroundGeolocation.configure({locationProvider:window.BackgroundGeolocation.DISTANCE_FILTER_PROVIDER,desiredAccuracy:window.BackgroundGeolocation.MEDIUM_ACCURACY,stationaryRadius:10,distanceFilter:10,stopOnTerminate:!1,debug:!0,startForeground:!0,notificationsEnabled:!0,httpHeaders:{"X-Auth":"\u010De ga rabi\u0161"},interval:5e3,fastestInterval:2e3,activitiesInterval:1e3}),window.BackgroundGeolocation.on("authorization",e=>{e!==window.BackgroundGeolocation.AUTHORIZED&&setTimeout(()=>{navigator.notification.confirm("Please enable location access",t=>{t===1&&window.BackgroundGeolocation.showAppSettings()},"Kataster jam")},1e3)}),window.BackgroundGeolocation.on("location",e=>{this.newLocationUpdate(e)}),this.watchId=navigator.compass.watchHeading(e=>{this.rotation=e.magneticHeading},e=>{alert("Compass error: "+e.code)},{frequency:1e3})),navigator.geolocation.watchPosition(e=>{this.foregroundLocationActivated&&e.coords.accuracy>10&&this.isCordova||this.newLocationUpdate(e.coords)},(e,t)=>{console.error("Error when trying to fetch location",e,t)},{enableHighAccuracy:!0})},newLocationUpdate(r){const e=Pt([r.longitude,r.latitude]);this.myLocation={coordinates:e,accuracy:r.accuracy,latitude:r.latitude,longitude:r.longitude},this.getLocationTracking&&this.updateMyTrack(e),this.getNavigationActive&&this.updateNavigation(e)},toggleLocationTracking(){this.locationTracking=!this.locationTracking,this.locationTracking&&this.isCordova&&window.BackgroundGeolocation.configure({notificationTitle:"Location tracking",notificationText:"Tracking your location is in progress"}),this.locationTracking?this.startForeground():this.stopForeground()},stopNavigation(){this.navigationActive=!1,this.stopForeground(),this.updateNavigation([])},startNavigation(r){this.goTo=r,this.navigateTo.length===2&&(this.navigateTo[0]=this.goTo.getGeometry().getCoordinates()),this.isCordova&&window.BackgroundGeolocation.configure({notificationTitle:"Navigation",notificationText:"Navigation to a location is in progress"}),this.navigationActive=!0,this.startForeground()},startForeground(){this.foregroundLocationActivated||(this.isCordova&&window.BackgroundGeolocation.start(),this.foregroundLocationActivated=!0)},stopForeground(){this.foregroundLocationActivated&&this.foregroundNotNeeded&&(this.isCordova&&window.BackgroundGeolocation.stop(),this.foregroundLocationActivated=!1)},updateMyTrack(r){this.myTrack.push(r)},updateNavigation(r){this.navigateTo=r.length===0?[]:[this.goTo.getGeometry().getCoordinates(),r]}}}),An={setup(){const r=K(),e=x(5),t=x("red");return{store:r,strokeWidth:e,strokeColor:t}},computed:{myTrack(){return this.store.getMyTrack}}};function Mn(r,e,t,n,o,i){const a=d("ol-geom-line-string"),s=d("ol-style-stroke"),u=d("ol-style"),c=d("ol-feature"),l=d("ol-source-vector"),h=d("ol-vector-layer");return I(),S(h,null,{default:y(()=>[v(l,null,{default:y(()=>[v(c,null,{default:y(()=>[v(a,{coordinates:i.myTrack},null,8,["coordinates"]),v(u,null,{default:y(()=>[v(s,{color:n.strokeColor,width:n.strokeWidth},null,8,["color","width"])]),_:1})]),_:1})]),_:1})]),_:1})}var Tn=N(An,[["render",Mn]]);const Fn=nt("div",{class:"q-space"});var Sn=St({name:"QSpace",setup(){return()=>Fn}});const kn={setup(){const r=x(!0),e=x("top"),t=K(),n=x(3),o=x("green");return{dialog:r,position:e,store:t,strokeWidth:n,strokeColor:o}},data(){return{currentCenter:this.center,currentZoom:this.zoom,currentResolution:this.resolution,fixedCenter:!1,name:this.$route.query.name}},computed:{bearing(){return(([t,n],[o,i])=>{const a=o-t,s=i-n;return(Math.atan2(a,s)*180/Math.PI+360)%360})(this.store.getNavigateTo[1],this.store.getNavigateTo[0])-this.store.getRotation},navigateTo(){return this.store.getNavigateTo},navigationInProgress(){return this.store.getNavigateTo.length>0},distance(){const r=new Lt(this.store.getNavigateTo),e=at(r);return e>1e3?(e/1e3).toFixed(2):parseInt(e)},distanceUnit(){const r=new Lt(this.store.getNavigateTo);return at(r)>1e3?"km":"m"}},methods:{stopNavigation(){this.store.stopNavigation()}}},Xn={class:"text-weight-bold"},Bn={class:"text-grey"};function Pn(r,e,t,n,o,i){const a=d("ol-geom-line-string"),s=d("ol-style-stroke"),u=d("ol-style"),c=d("ol-feature"),l=d("ol-source-vector"),h=d("ol-vector-layer");return I(),st(ut,null,[v(ie,{modelValue:i.navigationInProgress,"onUpdate:modelValue":e[0]||(e[0]=p=>i.navigationInProgress=p),position:n.position,seamless:"",class:"q-dialog__top50"},{default:y(()=>[v(re,{style:{width:"350px"}},{default:y(()=>[v(oe,{class:"row items-center no-wrap"},{default:y(()=>[W("div",null,[W("div",Xn,G(r.$t("goTo"))+": "+G(o.name),1),W("div",Bn,G(r.$t("distance"))+": "+G(i.distance)+" "+G(i.distanceUnit),1)]),v(Sn),v(kt,{name:"navigation",style:Xt({rotate:i.bearing+"deg"}),size:"lg"},null,8,["style"]),v(rt,{flat:"",round:"",icon:"stop",onClick:i.stopNavigation},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","position"]),v(h,null,{default:y(()=>[v(l,null,{default:y(()=>[v(c,null,{default:y(()=>[v(a,{coordinates:i.navigateTo},null,8,["coordinates"]),v(u,null,{default:y(()=>[v(s,{color:n.strokeColor,width:n.strokeWidth},null,8,["color","width"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}var Yn=N(kn,[["render",Pn]]);const Nn={props:["view"],emits:["centerChanged"],components:{TrackingLayer:Tn,NavigationLayer:Yn},setup(){const r=K(),e=x([]),t=x([]),{myLocation:n}=ae(r);return{store:r,myLocationCoordinates:e,myLocationFeatures:t,myLocation:n}},computed:{rotation(){return this.store.getRotation}},watch:{myLocation(r,e){const t=tn([r.longitude,r.latitude],this.store.getMyLocationAccuracy);this.myLocationFeatures=[new it(t.transform("EPSG:4326",this.store.getProjection)),new it(new ft(this.store.getMyLocationCoordinates))],this.myLocationCoordinates=r.coordinates,this.$emit("centerChanged",this.store.getMyLocationCoordinates)}}};function $n(r,e,t,n,o,i){const a=d("ol-source-vector"),s=d("ol-vector-layer"),u=d("ol-overlay"),c=d("TrackingLayer"),l=d("NavigationLayer");return I(),st(ut,null,[v(s,null,{default:y(()=>[v(a,{features:n.myLocationFeatures},null,8,["features"])]),_:1}),n.myLocationFeatures.length>0?(I(),S(u,{key:0,position:n.myLocationCoordinates,positioning:"center-center"},{default:y(h=>[v(kt,{name:"navigation",class:se(h),style:Xt({rotate:i.rotation+"deg"}),size:"lg"},null,8,["class","style"])]),_:1},8,["position"])):Bt("",!0),v(c),v(l)],64)}var Gn=N(Nn,[["render",$n]]);const On={setup(){const r=Se(),e=x([]),t=x(new wn);return r.loadForMap().then(()=>{console.log("locations loaded"),r.customLocationsForMap.map(n=>e.value.push(n))}),{vectorSource:t,store:r,customLocations:e}}};function bn(r,e,t,n,o,i){const a=d("ol-geom-point"),s=d("ol-style-icon"),u=d("ol-style"),c=d("ol-feature"),l=d("ol-source-vector"),h=d("ol-vector-layer");return I(),S(h,null,{default:y(()=>[v(l,{ref:"vectorSource"},{default:y(()=>[(I(!0),st(ut,null,ue(n.customLocations,p=>(I(),S(c,{key:p.id,properties:{id:p.id,name:p.name}},{default:y(()=>[v(a,{coordinates:p.latLng},null,8,["coordinates"]),v(u,null,{default:y(()=>[v(s,{src:p.icon,scale:1},null,8,["src"])]),_:2},1024)]),_:2},1032,["properties"]))),128))]),_:1},512)]),_:1})}var Dn=N(On,[["render",bn]]);const Un=ce({name:"IndexPage",components:{PageFullScreen:Ln,CartoLayers:Te,LocationLayers:Gn,CustomLocationLayers:Dn},setup(){const r=K(),e=x([1637531,5766419]),t=x("EPSG:3857"),n=x(8),o=x(!1),i=x([]),a=x(null),s=x("");return{store:r,center:e,projection:t,zoom:n,view:s,markLocations:i,goTo:a,customLocations:o}},data(){if(this.$route.query.lat&&this.$route.query.lng){const r=Pt([this.$route.query.lng,this.$route.query.lat]),e=new it(new ft(r));this.markLocations=[e],this.center=r,this.zoom=15,this.goTo=this.$route.query.navigate?e:null}return this.customLocations=this.$route.query.customLocation,{currentCenter:this.center,currentZoom:this.zoom,currentResolution:this.resolution,fixedCenter:!1}},computed:{trackLocationIcon(){return this.store.getLocationTracking},navigationActive(){return this.store.getNavigationActive},isCenterFixed(){return this.fixedCenter}},methods:{zoomChanged(r){this.currentZoom=r},trackingClicked(r){this.store.toggleLocationTracking()},myLocationClicked(r){this.center=this.store.getMyLocationCoordinates,this.fixedCenter=!0,this.zoom=this.zoom<15?15:this.currentZoom},resolutionChanged(r){this.currentResolution=r},centerChanged(r){this.view!==""&&(this.currentCenter=r,this.view.getInteracting()?this.fixedCenter=!1:this.fixedCenter&&(this.center=r))}},watch:{view(r,e){this.store.initialize(r.getProjection()),this.goTo&&this.store.startNavigation(this.goTo)}}});function qn(r,e,t,n,o,i){const a=d("ol-view"),s=d("CartoLayers"),u=d("LocationLayers"),c=d("CustomLocationLayers"),l=d("ol-source-vector"),h=d("ol-vector-layer"),p=d("ol-map"),f=d("PageFullScreen");return I(),S(f,{style:{background:"#eee"}},{default:y(()=>[v(p,{loadTilesWhileAnimating:"",loadTilesWhileInteracting:"",style:{height:"100%"}},{default:y(()=>[v(a,{ref:"view",enableRotation:!1,center:r.center,zoom:r.zoom,projection:r.projection,onZoomChanged:r.zoomChanged,onCenterChanged:r.centerChanged,onResolutionChanged:r.resolutionChanged},null,8,["center","zoom","projection","onZoomChanged","onCenterChanged","onResolutionChanged"]),v(s),v(u,{view:r.view,onCenterChanged:r.centerChanged},null,8,["view","onCenterChanged"]),r.customLocations?(I(),S(c,{key:0})):Bt("",!0),v(h,null,{default:y(()=>[v(l,{features:r.markLocations},null,8,["features"])]),_:1})]),_:1}),v(Et,{position:"bottom-left",offset:[18,18]},{default:y(()=>[v(rt,{fab:"",icon:r.isCenterFixed?"my_location":"location_searching",color:"accent",onClick:r.myLocationClicked},null,8,["icon","onClick"])]),_:1}),v(Et,{position:"bottom-right",offset:[18,18]},{default:y(()=>[v(rt,{fab:"",icon:r.trackLocationIcon?"stop_circle":"play_arrow",color:"accent",onClick:r.trackingClicked},null,8,["icon","onClick"])]),_:1})]),_:1})}var Qn=N(Un,[["render",qn]]);export{Qn as default};
