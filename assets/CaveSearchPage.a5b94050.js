import{_ as Q,y as S,r as d,j as i,k as C,d as a,D as r,J as w,L as y,F as b,C as p,an as h,b2 as _,bo as N,E as m,H as n,m as P,bp as q,bq as F}from"./index.424b4f7f.js";import{a as $,b as v,Q as f}from"./QItem.e089ab18.js";import{Q as L}from"./QSlideItem.15fb307d.js";import{Q as M}from"./format.4b2440d1.js";import{Q as I}from"./QPullToRefresh.25e3d8a5.js";import{u as T}from"./use-quasar.7517840a.js";const V={name:"CaveSearchPage",setup(){const{dialog:e}=T(),t=S();t.getCaves.length===0&&t.searchForCaves().then(()=>{console.log("caves loaded")});const c=d(t.getQuery),l=d(null),u=d(null);return{confirmDialog:e,store:t,query:c,confirm:d(!1),selectedCave:l,closeSlider:null,confirmRef:u}},computed:{caves(){return this.store.getCaves},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,t;return`[${(e=this.selectedCave)==null?void 0:e.caveNumber}] ${(t=this.selectedCave)==null?void 0:t.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,t){this.executeSearch()}},methods:{goTo({reset:e},t){var l,u;e(),this.selectedCave=t;const c=`[${(l=this.selectedCave)==null?void 0:l.caveNumber}] ${(u=this.selectedCave)==null?void 0:u.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCave")}: ${c}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCave.lat,lng:this.selectedCave.lng,navigate:!0,name:c}})})},caveClick(e){this.$router.push({name:"caves-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng}})},async loadMore(){this.store.incrementPageNumber(),await this.store.searchForCaves()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves();return}await this.store.searchForNearbyCaves()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearbyCaves():await this.store.searchForCaves(),e()}}};function R(e,t,c,l,u,o){return i(),C(b,null,[a(w,{loading:o.searching,modelValue:l.query,"onUpdate:modelValue":t[1]||(t[1]=s=>l.query=s),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCave")},{append:r(()=>[l.query!==""?(i(),p(h,{key:0,name:"close",onClick:t[0]||(t[0]=s=>l.query=""),class:"cursor-pointer"})):(i(),p(h,{key:1,name:"search"}))]),after:r(()=>[a(y,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:o.searchAroundMe,color:o.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),a(I,{onRefresh:o.refresh},{default:r(()=>[a(M,{ref:"scrollTargetRef",class:"scroll"},{default:r(()=>[(i(!0),C(b,null,_(o.caves,(s,k)=>(i(),C("div",{key:k},[a(L,{onLeft:g=>o.goTo(g,s)},{left:r(()=>[a(h,{name:"assist_walker"})]),default:r(()=>[a($,{clickable:"",onClick:g=>o.caveClick(s.caveNumber)},{default:r(()=>[a(v,{avatar:"",top:""},{default:r(()=>[a(N,{icon:"info",color:"primary","text-color":"white"}),a(h,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),a(v,null,{default:r(()=>[a(f,{lines:"1"},{default:r(()=>[m(n(s.caveNumber)+" - "+n(s.name),1)]),_:2},1024),a(f,{caption:""},{default:r(()=>[m(n(e.$t("length"))+": "+n(s.length)+" m, "+n(e.$t("depth"))+": "+n(s.depth)+" m",1)]),_:2},1024),a(f,{caption:""},{default:r(()=>[m(n(s.organization),1)]),_:2},1024),s.distance?(i(),p(f,{key:0,caption:""},{default:r(()=>[m(n(e.$t("distance"))+": "+n(parseInt(s.distance))+" m",1)]),_:2},1024)):P("",!0)]),_:2},1024),a(v,{side:""},{default:r(()=>[a(h,{name:"map",color:"green",size:"lg",onClick:q(g=>o.showOnMapClick(s),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),a(F)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),a(y,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var E=Q(V,[["render",R]]);export{E as default};
