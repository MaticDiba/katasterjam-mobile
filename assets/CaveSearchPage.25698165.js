import{_ as Q,M as S,r as h,j as i,k as C,d as a,P as r,W as w,Y as y,F as k,O as v,al as d,aN as _,bB as N,Q as m,S as n,m as P,bC as q,bD as F}from"./index.56610da6.js";import{Q as $,c as M,d as p,a as g}from"./format.dd601019.js";import{Q as L,a as I}from"./QPullToRefresh.b1f21058.js";import{u as T}from"./use-quasar.f86621e6.js";const V={name:"CaveSearchPage",setup(){const{dialog:e}=T(),t=S();t.getCaves.length===0&&t.searchForCaves().then(()=>{console.log("caves loaded")});const c=h(t.getQuery),o=h(null),u=h(null);return{confirmDialog:e,store:t,query:c,confirm:h(!1),selectedCave:o,closeSlider:null,confirmRef:u}},computed:{caves(){return this.store.getCaves},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,t;return`[${(e=this.selectedCave)==null?void 0:e.caveNumber}] ${(t=this.selectedCave)==null?void 0:t.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,t){this.executeSearch()}},methods:{goTo({reset:e},t){var o,u;e(),this.selectedCave=t;const c=`[${(o=this.selectedCave)==null?void 0:o.caveNumber}] ${(u=this.selectedCave)==null?void 0:u.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCave")}: ${c}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCave.lat,lng:this.selectedCave.lng,navigate:!0,name:c}})})},caveClick(e){this.$router.push({name:"caves-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng}})},async loadMore(){this.store.incrementPageNumber(),await this.store.searchForCaves()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.searchForCaves();return}await this.store.searchForNearbyCaves()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearbyCaves():await this.store.searchForCaves(),e()}}};function B(e,t,c,o,u,l){return i(),C(k,null,[a(w,{loading:l.searching,modelValue:o.query,"onUpdate:modelValue":t[1]||(t[1]=s=>o.query=s),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCave")},{append:r(()=>[o.query!==""?(i(),v(d,{key:0,name:"close",onClick:t[0]||(t[0]=s=>o.query=""),class:"cursor-pointer"})):(i(),v(d,{key:1,name:"search"}))]),after:r(()=>[a(y,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:l.searchAroundMe,color:l.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),a(L,{onRefresh:l.refresh},{default:r(()=>[a($,{ref:"scrollTargetRef",class:"scroll"},{default:r(()=>[(i(!0),C(k,null,_(l.caves,(s,b)=>(i(),C("div",{key:b},[a(I,{onLeft:f=>l.goTo(f,s)},{left:r(()=>[a(d,{name:"assist_walker"})]),default:r(()=>[a(M,{clickable:"",onClick:f=>l.caveClick(s.caveNumber)},{default:r(()=>[a(p,{avatar:"",top:""},{default:r(()=>[a(N,{icon:"info",color:"primary","text-color":"white"}),a(d,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),a(p,null,{default:r(()=>[a(g,{lines:"1"},{default:r(()=>[m(n(s.caveNumber)+" - "+n(s.name),1)]),_:2},1024),a(g,{caption:""},{default:r(()=>[m(n(e.$t("length"))+": "+n(s.length)+" m, "+n(e.$t("depth"))+": "+n(s.depth)+" m",1)]),_:2},1024),a(g,{caption:""},{default:r(()=>[m(n(s.organization),1)]),_:2},1024),s.distance?(i(),v(g,{key:0,caption:""},{default:r(()=>[m(n(e.$t("distance"))+": "+n(parseInt(s.distance))+" m",1)]),_:2},1024)):P("",!0)]),_:2},1024),a(p,{side:""},{default:r(()=>[a(d,{name:"map",color:"green",size:"lg",onClick:q(f=>l.showOnMapClick(s),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),a(F)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),a(y,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:l.loadMore,disabled:l.totalPages<=l.pageNumber},null,8,["label","onClick","disabled"])],64)}var x=Q(V,[["render",B]]);export{x as default};
