import{bb as Pe,bc as Ae,bd as b,be as D,bf as Ce,bg as le,bh as Z,bi as Oe,bj as ee,bk as ce,aU as Le,bl as we,bm as Ie,_ as pe,z as me,r as z,am as q,j as B,C as _e,bn as he,B as Ne,k as fe,d as X,D as de,F as ve,b2 as be}from"./index.424b4f7f.js";function ne(t,e){return Te(t,e,[]).join("")}function Te(t,e,r){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?r.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):r.push(t.nodeValue);else{var n=void 0;for(n=t.firstChild;n;n=n.nextSibling)Te(n,e,r)}return r}function De(t){return"documentElement"in t}function je(t){return new DOMParser().parseFromString(t,"application/xml")}function re(t,e){return function(r,n){var i=t.call(e!==void 0?e:this,r,n);if(i!==void 0){var a=n[n.length-1];a.push(i)}}}function x(t,e,r){return function(n,i){var a=t.call(r!==void 0?r:this,n,i);if(a!==void 0){var c=i[i.length-1],s=e!==void 0?e:n.localName,v=void 0;s in c?v=c[s]:(v=[],c[s]=v),v.push(a)}}}function o(t,e,r){return function(n,i){var a=t.call(r!==void 0?r:this,n,i);if(a!==void 0){var c=i[i.length-1],s=e!==void 0?e:n.localName;c[s]=a}}}function l(t,e,r){var n=r!==void 0?r:{},i,a;for(i=0,a=t.length;i<a;++i)n[t[i]]=e;return n}function Fe(t,e,r,n){var i;for(i=e.firstElementChild;i;i=i.nextElementSibling){var a=t[i.namespaceURI];if(a!==void 0){var c=a[i.localName];c!==void 0&&c.call(n,i,r)}}}function f(t,e,r,n,i){return n.push(t),Fe(e,r,n,i),n.pop()}function Ve(t){var e=ne(t,!1);return Ue(e)}function Ue(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);if(e)return parseFloat(e[1])}function C(t){var e=ne(t,!1);return We(e)}function We(t){var e=/^\s*(\d+)\s*$/.exec(t);if(e)return parseInt(e[1],10)}function u(t){return ne(t,!1).trim()}var Ge=function(){function t(){}return t.prototype.read=function(e){if(e)if(typeof e=="string"){var r=je(e);return this.readFromDocument(r)}else return De(e)?this.readFromDocument(e):this.readFromNode(e);else return null},t.prototype.readFromDocument=function(e){for(var r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFromNode(r);return null},t.prototype.readFromNode=function(e){},t}(),ye=Ge,$e="http://www.w3.org/1999/xlink";function ie(t){return t.getAttributeNS($e,"href")}var ke=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),T=[null,"http://www.opengis.net/ows/1.1"],ze=l(T,{ServiceIdentification:o(pr),ServiceProvider:o(_r),OperationsMetadata:o(vr)}),qe=function(t){ke(e,t);function e(){return t.call(this)||this}return e.prototype.readFromNode=function(r){var n=f({},ze,r,[]);return n||null},e}(ye),Ke=l(T,{DeliveryPoint:o(u),City:o(u),AdministrativeArea:o(u),PostalCode:o(u),Country:o(u),ElectronicMailAddress:o(u)}),He=l(T,{Value:x(hr)}),Xe=l(T,{AllowedValues:o(or)}),Be=l(T,{Phone:o(Sr),Address:o(ar)}),Ye=l(T,{HTTP:o(fr)}),Je=l(T,{Get:x(cr),Post:void 0}),Qe=l(T,{DCP:o(lr)}),Ze=l(T,{Operation:dr}),er=l(T,{Voice:o(u),Facsimile:o(u)}),rr=l(T,{Constraint:x(sr)}),tr=l(T,{IndividualName:o(u),PositionName:o(u),ContactInfo:o(ur)}),nr=l(T,{Abstract:o(u),AccessConstraints:o(u),Fees:o(u),Title:o(u),ServiceTypeVersion:o(u),ServiceType:o(u)}),ir=l(T,{ProviderName:o(u),ProviderSite:o(ie),ServiceContact:o(mr)});function ar(t,e){return f({},Ke,t,e)}function or(t,e){return f({},He,t,e)}function sr(t,e){var r=t.getAttribute("name");if(!!r)return f({name:r},Xe,t,e)}function ur(t,e){return f({},Be,t,e)}function lr(t,e){return f({},Ye,t,e)}function cr(t,e){var r=ie(t);if(!!r)return f({href:r},rr,t,e)}function fr(t,e){return f({},Je,t,e)}function dr(t,e){var r=t.getAttribute("name"),n=f({},Qe,t,e);if(!!n){var i=e[e.length-1];i[r]=n}}function vr(t,e){return f({},Ze,t,e)}function Sr(t,e){return f({},er,t,e)}function pr(t,e){return f({},nr,t,e)}function mr(t,e){return f({},tr,t,e)}function _r(t,e){return f({},ir,t,e)}function hr(t,e){return u(t)}var Tr=qe,yr=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),R=[null,"http://www.opengis.net/wmts/1.0"],j=[null,"http://www.opengis.net/ows/1.1"],xr=l(R,{Contents:o(Nr)}),gr=function(t){yr(e,t);function e(){var r=t.call(this)||this;return r.owsParser_=new Tr,r}return e.prototype.readFromNode=function(r){var n=r.getAttribute("version");n&&(n=n.trim());var i=this.owsParser_.readFromNode(r);return i?(i.version=n,i=f(i,xr,r,[]),i||null):null},e}(ye),Rr=l(R,{Layer:x(br),TileMatrixSet:x(Dr)}),Mr=l(R,{Style:x(jr),Format:x(u),TileMatrixSetLink:x(Fr),Dimension:x(Vr),ResourceURL:x(Ur)},l(j,{Title:o(u),Abstract:o(u),WGS84BoundingBox:o(xe),Identifier:o(u)})),Er=l(R,{LegendURL:x(Wr)},l(j,{Title:o(u),Identifier:o(u)})),Pr=l(R,{TileMatrixSet:o(u),TileMatrixSetLimits:o($r)}),Ar=l(R,{TileMatrixLimits:re(kr)}),Cr=l(R,{TileMatrix:o(u),MinTileRow:o(C),MaxTileRow:o(C),MinTileCol:o(C),MaxTileCol:o(C)}),Or=l(R,{Default:o(u),Value:x(u)},l(j,{Identifier:o(u)})),Lr=l(j,{LowerCorner:re(te),UpperCorner:re(te)}),wr=l(R,{WellKnownScaleSet:o(u),TileMatrix:x(Gr)},l(j,{SupportedCRS:o(u),Identifier:o(u),BoundingBox:o(xe)})),Ir=l(R,{TopLeftCorner:o(te),ScaleDenominator:o(Ve),TileWidth:o(C),TileHeight:o(C),MatrixWidth:o(C),MatrixHeight:o(C)},l(j,{Identifier:o(u)}));function Nr(t,e){return f({},Rr,t,e)}function br(t,e){return f({},Mr,t,e)}function Dr(t,e){return f({},wr,t,e)}function jr(t,e){var r=f({},Er,t,e);if(!!r){var n=t.getAttribute("isDefault")==="true";return r.isDefault=n,r}}function Fr(t,e){return f({},Pr,t,e)}function Vr(t,e){return f({},Or,t,e)}function Ur(t,e){var r=t.getAttribute("format"),n=t.getAttribute("template"),i=t.getAttribute("resourceType"),a={};return r&&(a.format=r),n&&(a.template=n),i&&(a.resourceType=i),a}function xe(t,e){var r=f([],Lr,t,e);if(r.length==2)return Pe(r)}function Wr(t,e){var r={};return r.format=t.getAttribute("format"),r.href=ie(t),r}function te(t,e){var r=u(t).split(/\s+/);if(!(!r||r.length!=2)){var n=+r[0],i=+r[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}}function Gr(t,e){return f({},Ir,t,e)}function $r(t,e){return f([],Ar,t,e)}function kr(t,e){return f({},Cr,t,e)}var zr=gr;function Se(t,e){var r=[];Object.keys(e).forEach(function(i){e[i]!==null&&e[i]!==void 0&&r.push(i+"="+encodeURIComponent(e[i]))});var n=r.join("&");return t=t.replace(/[?&]$/,""),t=t.indexOf("?")===-1?t+"?":t+"&",t+n}var qr=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Kr=function(t){qr(e,t);function e(r){var n=t.call(this,{extent:r.extent,origin:r.origin,origins:r.origins,resolutions:r.resolutions,tileSize:r.tileSize,tileSizes:r.tileSizes,sizes:r.sizes})||this;return n.matrixIds_=r.matrixIds,n}return e.prototype.getMatrixId=function(r){return this.matrixIds_[r]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}(Ae);function Hr(t,e,r){var n=[],i=[],a=[],c=[],s=[],v=r!==void 0?r:[],P="SupportedCRS",S="TileMatrix",p="Identifier",h="ScaleDenominator",_="TopLeftCorner",K="TileWidth",F="TileHeight",V=t[P],U=b(V),g=U.getMetersPerUnit(),M=U.getAxisOrientation().substr(0,2)=="ne";return t[S].sort(function(m,A){return A[h]-m[h]}),t[S].forEach(function(m){var A;if(v.length>0?A=D(v,function(y){return m[p]==y[S]?!0:m[p].indexOf(":")===-1?t[p]+":"+m[p]===y[S]:!1}):A=!0,A){i.push(m[p]);var L=m[h]*28e-5/g,w=m[K],W=m[F];M?a.push([m[_][1],m[_][0]]):a.push(m[_]),n.push(L),c.push(w==W?w:[w,W]),s.push([m.MatrixWidth,m.MatrixHeight])}}),new Kr({extent:e,origins:a,resolutions:n,matrixIds:i,tileSizes:c,sizes:s})}var Xr=globalThis&&globalThis.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Br=function(t){Xr(e,t);function e(r){var n=this,i=r.imageSmoothing!==void 0?r.imageSmoothing:!0;r.interpolate!==void 0&&(i=r.interpolate);var a=r.requestEncoding!==void 0?r.requestEncoding:"KVP",c=r.tileGrid,s=r.urls;return s===void 0&&r.url!==void 0&&(s=Ce(r.url)),n=t.call(this,{attributions:r.attributions,attributionsCollapsible:r.attributionsCollapsible,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,interpolate:i,projection:r.projection,reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileClass:r.tileClass,tileGrid:c,tileLoadFunction:r.tileLoadFunction,tilePixelRatio:r.tilePixelRatio,urls:s,wrapX:r.wrapX!==void 0?r.wrapX:!1,transition:r.transition,zDirection:r.zDirection})||this,n.version_=r.version!==void 0?r.version:"1.0.0",n.format_=r.format!==void 0?r.format:"image/jpeg",n.dimensions_=r.dimensions!==void 0?r.dimensions:{},n.layer_=r.layer,n.matrixSet_=r.matrixSet,n.style_=r.style,n.requestEncoding_=a,n.setKey(n.getKeyForDimensions_()),s&&s.length>0&&(n.tileUrlFunction=le(s.map(n.createFromWMTSTemplate.bind(n)))),n}return e.prototype.setUrls=function(r){this.urls=r;var n=r.join(`
`);this.setTileUrlFunction(le(r.map(this.createFromWMTSTemplate.bind(this))),n)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var r=0,n=[];for(var i in this.dimensions_)n[r++]=i+"-"+this.dimensions_[i];return n.join("/")},e.prototype.updateDimensions=function(r){Z(this.dimensions_,r),this.setKey(this.getKeyForDimensions_())},e.prototype.createFromWMTSTemplate=function(r){var n=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};n=="KVP"&&Z(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),r=n=="KVP"?Se(r,i):r.replace(/\{(\w+?)\}/g,function(s,v){return v.toLowerCase()in i?i[v.toLowerCase()]:s});var a=this.tileGrid,c=this.dimensions_;return function(s,v,P){if(s){var S={TileMatrix:a.getMatrixId(s[0]),TileCol:s[1],TileRow:s[2]};Z(S,c);var p=r;return n=="KVP"?p=Se(p,S):p=p.replace(/\{(\w+?)\}/g,function(h,_){return S[_]}),p}else return}},e}(Oe),Yr=Br;function Jr(t,e){var r=t.Contents.Layer,n=D(r,function(d,$,k){return d.Identifier==e.layer});if(n===null)return null;var i=t.Contents.TileMatrixSet,a;n.TileMatrixSetLink.length>1?"projection"in e?a=ee(n.TileMatrixSetLink,function(d,$,k){var Q=D(i,function(Ee){return Ee.Identifier==d.TileMatrixSet}),N=Q.SupportedCRS,se=b(N),ue=b(e.projection);return se&&ue?ce(se,ue):N==e.projection}):a=ee(n.TileMatrixSetLink,function(d,$,k){return d.TileMatrixSet==e.matrixSet}):a=0,a<0&&(a=0);var c=n.TileMatrixSetLink[a].TileMatrixSet,s=n.TileMatrixSetLink[a].TileMatrixSetLimits,v=n.Format[0];"format"in e&&(v=e.format),a=ee(n.Style,function(d,$,k){return"style"in e?d.Title==e.style:d.isDefault}),a<0&&(a=0);var P=n.Style[a].Identifier,S={};"Dimension"in n&&n.Dimension.forEach(function(d,$,k){var Q=d.Identifier,N=d.Default;N===void 0&&(N=d.Value[0]),S[Q]=N});var p=t.Contents.TileMatrixSet,h=D(p,function(d,$,k){return d.Identifier==c}),_,K=h.SupportedCRS;if(K&&(_=b(K)),"projection"in e){var F=b(e.projection);F&&(!_||ce(F,_))&&(_=F)}var V=!1,U=_.getAxisOrientation().substr(0,2)=="ne",g=h.TileMatrix[0],M={MinTileCol:0,MinTileRow:0,MaxTileCol:g.MatrixWidth-1,MaxTileRow:g.MatrixHeight-1};if(s){M=s[s.length-1];var m=D(h.TileMatrix,function(d){return d.Identifier===M.TileMatrix||h.Identifier+":"+d.Identifier===M.TileMatrix});m&&(g=m)}var A=g.ScaleDenominator*28e-5/_.getMetersPerUnit(),L=U?[g.TopLeftCorner[1],g.TopLeftCorner[0]]:g.TopLeftCorner,w=g.TileWidth*A,W=g.TileHeight*A,y=h.BoundingBox;y&&U&&(y=[y[1],y[0],y[3],y[2]]);var Y=[L[0]+w*M.MinTileCol,L[1]-W*(1+M.MaxTileRow),L[0]+w*(1+M.MaxTileCol),L[1]-W*M.MinTileRow];if(y!==void 0&&!Le(y,Y)){var J=n.WGS84BoundingBox,H=b("EPSG:4326").getExtent();if(Y=y,J)V=J[0]===H[0]&&J[2]===H[2];else{var ae=we(y,h.SupportedCRS,"EPSG:4326");V=ae[0]-1e-10<=H[0]&&ae[2]+1e-10>=H[2]}}var ge=Hr(h,Y,s),G=[],E=e.requestEncoding;if(E=E!==void 0?E:"","OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var I=t.OperationsMetadata.GetTile.DCP.HTTP.Get,O=0,Re=I.length;O<Re;++O)if(I[O].Constraint){var Me=D(I[O].Constraint,function(d){return d.name=="GetEncoding"}),oe=Me.AllowedValues.Value;if(E===""&&(E=oe[0]),E==="KVP")Ie(oe,"KVP")&&G.push(I[O].href);else break}else I[O].href&&(E="KVP",G.push(I[O].href));return G.length===0&&(E="REST",n.ResourceURL.forEach(function(d){d.resourceType==="tile"&&(v=d.format,G.push(d.template))})),{urls:G,layer:e.layer,matrixSet:c,format:v,projection:_,requestEncoding:E,tileGrid:ge,style:P,dimensions:S,wrapX:V,crossOrigin:e.crossOrigin}}const Qr={props:{layer:Object},setup(){const t=me();return{layerRef:z(null),mapStore:t}},async mounted(){await(async(e,r)=>{const n=new zr,i=localStorage.getItem(`cap-${e.label}`),a=n.read(i),c=Jr(a,{layer:e.layerName}),s={projection:e.projection,...c,attributions:[e.attributes],crossOrigin:"anonymous"},v=new Yr(s);this.mapStore.setSource(e,v),v.setTileLoadFunction(async(P,S)=>{const p=P.getImage(),h=await he.tiles.where("tileKey").equals(S).first();if(!h){p.src=S;return}const _=URL.createObjectURL(h.image);p.onload=function(){URL.revokeObjectURL(_)},p.src=_}),r.tileLayer.setVisible(this.layer.active),r.tileLayer.setSource(v)})(this.layer,this.layerRef)},watch:{layer:{deep:!0,handler:function(t,e){this.layerRef.tileLayer.setVisible(t.active)}}}};function Zr(t,e,r,n,i,a){const c=q("ol-tile-layer");return B(),_e(c,{ref:"layerRef"},null,512)}var et=pe(Qr,[["render",Zr]]);const rt={components:{CustomWMTSLayer:et},setup(){const t=me(),e=z(null),r=z(null),n=z(null),i=z(null),{isSkyViewActive:a,isOrthoPhotoActive:c,getOrthoPhoto:s}=Ne(t);return{skyViewLayer:e,orthoPhotoLayer:r,isSkyViewActive:a,isOrthoPhotoActive:c,mapStore:t,getOrthoPhoto:s,osmSource:i,cavesSource:n}},watch:{isSkyViewActive(t,e){this.skyViewLayer.tileLayer.setVisible(t)}},async mounted(){[this.cavesSource,this.osmSource].map(t=>t.source.setTileLoadFunction(async(e,r)=>{const n=e.getImage(),i=r.replace(/^(https?:\/\/)[abc]\./,"$1"),a=await he.tiles.where("tileKey").equals(i).first();if(!a){n.src=r;return}const c=URL.createObjectURL(a.image);n.onload=function(){URL.revokeObjectURL(c)},n.src=c}))}};function tt(t,e,r,n,i,a){const c=q("ol-source-osm"),s=q("ol-tile-layer"),v=q("CustomWMTSLayer"),P=q("ol-source-xyz");return B(),fe(ve,null,[X(s,null,{default:de(()=>[X(c,{ref:"osmSource"},null,512)]),_:1}),(B(!0),fe(ve,null,be(n.mapStore.getLayers,S=>(B(),_e(v,{key:S.name,layer:S},null,8,["layer"]))),128)),X(s,null,{default:de(()=>[X(P,{ref:"cavesSource",url:"https://services7.arcgis.com/V2VriwTjJDabpGg6/ArcGIS/rest/services/2022_marec_export_ekataster_tile_layer/MapServer/WMTS/tile/1.0.0/2022_marec_export_ekataster_tile_layer/default/default028mm/{z}/{y}/{x}.png"},null,512)]),_:1})],64)}var it=pe(rt,[["render",tt]]);export{it as C};
