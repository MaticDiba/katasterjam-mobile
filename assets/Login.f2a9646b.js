import{Q as M,a as E,b as R,c as O,d as j}from"./QLayout.4a24ba34.js";import{s as k,r as P,p as K,u as U,v as J,o as X,h as s,x as Y,g as H,y as G,z as F,A as W,B as Z,C as ee,D as te,E as ae,c as g,G as D,H as oe,I as se,J as re,K as le,_ as ne,L as ie,M as ue,N as ce,O as V,j as N,P as T,Q as d,d as i,R as I,S as h,U as w,V as de,W as L,X as z,Y as ge,Z as fe,m as me}from"./index.18ea7970.js";import{Q as ve}from"./QPage.d44e45a6.js";import{u as he}from"./use-quasar.c588333e.js";import"./QResizeObserver.7628afe8.js";var be=k({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:a,emit:r}){const u=H(),o=P(null);let c=0;const n=[];function S(t){const m=typeof t=="boolean"?t:e.noErrorFocus!==!0,_=++c,p=(l,f)=>{r("validation"+(l===!0?"Success":"Error"),f)},$=l=>{const f=l.validate();return typeof f.then=="function"?f.then(v=>({valid:v,comp:l}),v=>({valid:!1,comp:l,err:v})):Promise.resolve({valid:f,comp:l})};return(e.greedy===!0?Promise.all(n.map($)).then(l=>l.filter(f=>f.valid!==!0)):n.reduce((l,f)=>l.then(()=>$(f).then(v=>{if(v.valid===!1)return Promise.reject(v)})),Promise.resolve()).catch(l=>[l])).then(l=>{if(l===void 0||l.length===0)return _===c&&p(!0),!0;if(_===c){const{comp:f,err:v}=l[0];if(v!==void 0&&console.error(v),p(!1,f),m===!0){const B=l.find(({comp:Q})=>typeof Q.focus=="function"&&G(Q.$)===!1);B!==void 0&&B.comp.focus()}}return!1})}function x(){c++,n.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function C(t){t!==void 0&&F(t);const m=c+1;S().then(_=>{m===c&&_===!0&&(e.onSubmit!==void 0?r("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function b(t){t!==void 0&&F(t),r("reset"),W(()=>{x(),e.autofocus===!0&&e.noResetFocus!==!0&&y()})}function y(){Z(()=>{if(o.value===null)return;const t=o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),m=>m.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}K(ee,{bindComponent(t){n.push(t)},unbindComponent(t){const m=n.indexOf(t);m>-1&&n.splice(m,1)}});let q=!1;return U(()=>{q=!0}),J(()=>{q===!0&&e.autofocus===!0&&y()}),X(()=>{e.autofocus===!0&&y()}),Object.assign(u.proxy,{validate:S,resetValidation:x,submit:C,reset:b,focus:y,getValidationComponents:()=>n}),()=>s("form",{class:"q-form",ref:o,onSubmit:C,onReset:b},Y(a.default))}});const ye=[s("g",[s("path",{fill:"none",stroke:"currentColor","stroke-width":"5","stroke-miterlimit":"10",d:"M58.4,51.7c-0.9-0.9-1.4-2-1.4-2.3s0.5-0.4,1.4-1.4 C70.8,43.8,79.8,30.5,80,15.5H70H30H20c0.2,15,9.2,28.1,21.6,32.3c0.9,0.9,1.4,1.2,1.4,1.5s-0.5,1.6-1.4,2.5 C29.2,56.1,20.2,69.5,20,85.5h10h40h10C79.8,69.5,70.8,55.9,58.4,51.7z"}),s("clipPath",{id:"uil-hourglass-clip1"},[s("rect",{x:"15",y:"20",width:" 70",height:"25"},[s("animate",{attributeName:"height",from:"25",to:"0",dur:"1s",repeatCount:"indefinite",values:"25;0;0",keyTimes:"0;0.5;1"}),s("animate",{attributeName:"y",from:"20",to:"45",dur:"1s",repeatCount:"indefinite",values:"20;45;45",keyTimes:"0;0.5;1"})])]),s("clipPath",{id:"uil-hourglass-clip2"},[s("rect",{x:"15",y:"55",width:" 70",height:"25"},[s("animate",{attributeName:"height",from:"0",to:"25",dur:"1s",repeatCount:"indefinite",values:"0;25;25",keyTimes:"0;0.5;1"}),s("animate",{attributeName:"y",from:"80",to:"55",dur:"1s",repeatCount:"indefinite",values:"80;55;55",keyTimes:"0;0.5;1"})])]),s("path",{d:"M29,23c3.1,11.4,11.3,19.5,21,19.5S67.9,34.4,71,23H29z","clip-path":"url(#uil-hourglass-clip1)",fill:"currentColor"}),s("path",{d:"M71.6,78c-3-11.6-11.5-20-21.5-20s-18.5,8.4-21.5,20H71.6z","clip-path":"url(#uil-hourglass-clip2)",fill:"currentColor"}),s("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"180 50 50",repeatCount:"indefinite",dur:"1s",values:"0 50 50;0 50 50;180 50 50",keyTimes:"0;0.7;1"})])];var _e=k({name:"QSpinnerHourglass",props:te,setup(e){const{cSize:a,classes:r}=ae(e);return()=>s("svg",{class:r.value,width:a.value,height:a.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},ye)}});const pe=["top","middle","bottom"];var Se=k({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>pe.includes(e)}},setup(e,{slots:a}){const r=g(()=>e.align!==void 0?{verticalAlign:e.align}:null),u=g(()=>{const o=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(o!==void 0?` text-${o}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>s("div",{class:u.value,style:r.value,role:"status","aria-label":e.label},D(a.default,e.label!==void 0?[e.label]:[]))}});const xe={xs:2,sm:4,md:6,lg:10,xl:14};function A(e,a,r){return{transform:a===!0?`translateX(${r.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var Ce=k({name:"QLinearProgress",props:{...oe,...se,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:a}){const{proxy:r}=H(),u=re(e,r.$q),o=le(e,xe),c=g(()=>e.indeterminate===!0||e.query===!0),n=g(()=>e.reverse!==e.query),S=g(()=>({...o.value!==null?o.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),x=g(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),C=g(()=>A(e.buffer!==void 0?e.buffer:1,n.value,r.$q)),b=g(()=>`with${e.instantFeedback===!0?"out":""}-transition`),y=g(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${b.value} q-linear-progress__track--${u.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),q=g(()=>A(c.value===!0?1:e.value,n.value,r.$q)),t=g(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${b.value} q-linear-progress__model--${c.value===!0?"in":""}determinate`),m=g(()=>({width:`${e.value*100}%`})),_=g(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${b.value}`);return()=>{const p=[s("div",{class:y.value,style:C.value}),s("div",{class:t.value,style:q.value})];return e.stripe===!0&&c.value===!1&&p.push(s("div",{class:_.value,style:m.value})),s("div",{class:x.value,style:S.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},D(a.default,p))}}});const qe={name:"LoginPage",setup(){const e=ie(),a=ue(),r=ce(),u=P(0),{getPageNumber:o}=V(a),{getPageNumber:c}=V(r),{notify:n}=he();return{notify:n,loggingIn:P(!1),store:e,cavesStore:a,progress:u,progressLabel:g(()=>(u.value*100).toFixed(2)+"%"),getPageNumber:o,customLocations:r,customLocationPage:c}},data(){return{account:{email:"",password:""},progressLabelTitle:this.$t("fetchingCaveData")}},watch:{getPageNumber(e,a){this.progress=e/this.cavesStore.totalPages},customLocationPage(e,a){this.progress=e/this.customLocations.getTotalPages}},methods:{async submitForm(){this.loggingIn=!0;try{const e={email:this.account.email,password:this.account.password,rememberMe:!0},a=await this.store.login(e);a.success?(await this.cavesStore.tryFetchCavesForOffline(),this.progress=0,this.progressLabelTitle=this.$t("fetchingCustomLocationData"),await this.customLocations.tryFetchCustomLocationsForOffline(),this.$router.replace("/")):console.error(a.message[0])}catch(e){console.error(e),this.notify({message:this.$t("loginFailed"),color:"red"})}finally{this.loggingIn=!1}}}},we={class:"column"},ke={class:"row"},Le={class:"text-h5 text-white q-my-md"},Pe={class:"row"},$e={class:"text-grey-6"},Be={class:"text-grey-6"},Qe={class:"absolute-full flex flex-center"};function Fe(e,a,r,u,o,c){return N(),T(M,{view:"lHh Lpr lFf"},{default:d(()=>[i(O,{elevated:""},{default:d(()=>[i(E,null,{default:d(()=>[i(R,null,{default:d(()=>[I(" eKatasterJam ")]),_:1})]),_:1})]),_:1}),i(j,null,{default:d(()=>[i(ve,{class:"bg-light-blue row justify-center items-center"},{default:d(()=>[h("div",we,[h("div",ke,[h("h5",Le,w(e.$t("logIn")),1)]),h("div",Pe,[i(de,{bordered:"",class:"q-pa-lg shadow-1"},{default:d(()=>[i(L,null,{default:d(()=>[i(be,{class:"q-gutter-md"},{default:d(()=>[i(z,{square:"",filled:"",clearable:"",modelValue:o.account.email,"onUpdate:modelValue":a[0]||(a[0]=n=>o.account.email=n),type:"email",label:e.$t("email")},null,8,["modelValue","label"]),i(z,{square:"",filled:"",clearable:"",modelValue:o.account.password,"onUpdate:modelValue":a[1]||(a[1]=n=>o.account.password=n),type:"password",label:e.$t("password")},null,8,["modelValue","label"])]),_:1})]),_:1}),i(ge,{class:"q-px-md"},{default:d(()=>[i(fe,{disable:u.loggingIn,loading:u.loggingIn,unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loginLabel"),onClick:c.submitForm,type:"submit"},{loading:d(()=>[i(_e,{class:"on-right"}),I(" "+w(e.$t("loggingIn")),1)]),_:1},8,["disable","loading","label","onClick"])]),_:1}),i(L,{class:"text-center q-pa-none"},{default:d(()=>[h("p",$e,w(e.$t("register")),1)]),_:1}),u.loggingIn?(N(),T(L,{key:0,class:"text-center q-pa-none"},{default:d(()=>[h("p",Be,w(o.progressLabelTitle),1),i(Ce,{"instant-feedback":!0,size:"50px",value:u.progress,color:"accent",class:"q-mt-sm"},{default:d(()=>[h("div",Qe,[i(Se,{color:"white","text-color":"accent",label:u.progressLabel},null,8,["label"])])]),_:1},8,["value"])]),_:1})):me("",!0)]),_:1})])])]),_:1})]),_:1})]),_:1})}var He=ne(qe,[["render",Fe]]);export{He as default};
