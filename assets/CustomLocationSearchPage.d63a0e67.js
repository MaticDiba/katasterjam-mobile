import{_ as S,N as w,r as h,bF as P,al as v,j as l,k as m,d as t,Q as s,X as N,Z as k,F as L,P as C,am as c,aO as q,bB as z,m as b,R as g,U as i,bC as $,bD as O}from"./index.18ea7970.js";import{Q as F,c as M,d as y,a as f}from"./format.85b5a3f8.js";import{Q as D,a as I}from"./QPullToRefresh.d7475729.js";import{u as T}from"./use-quasar.c588333e.js";import{O as R}from"./OrganizationsList.97941f92.js";const V={name:"CustomLocationSearchPage",components:{OrganizationsList:R},setup(){const{dialog:e}=T(),a=w();a.tryFetchCustomLocationsForOffline().then(()=>{console.log("Custom location list updated")}),a.getCustomLocations.length===0&&a.search().then(()=>{console.log("custom locations loaded")});const u=h(a.getQuery),n=h(null),d=h(null);return{confirmDialog:e,store:a,query:u,confirm:h(!1),selectedCustomLocation:n,closeSlider:null,confirmRef:d,formatDate:P}},computed:{customLocations(){return this.store.getCustomLocations},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,a;return`[${(e=this.selectedCustomLocation)==null?void 0:e.id}] ${(a=this.selectedCustomLocation)==null?void 0:a.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,a){this.executeSearch()}},methods:{goTo({reset:e},a){var n,d;e(),this.selectedCustomLocation=a;const u=`[${(n=this.selectedCustomLocation)==null?void 0:n.id}] ${(d=this.selectedCustomLocation)==null?void 0:d.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCustomLocation")}: ${u}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCustomLocation.lat,lng:this.selectedCustomLocation.lng,navigate:!0,customLocation:!0,name:u}})})},customLocationClick(e){this.$router.push({name:"custom-locations-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng,customLocation:!0}})},async loadMore(){this.store.incrementPageNumber(),await this.store.search()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search();return}await this.store.searchForNearby()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearby():await this.store.search(),e()}}},B={key:0};function A(e,a,u,n,d,o){const Q=v("OrganizationsList");return l(),m(L,null,[t(N,{loading:o.searching,modelValue:n.query,"onUpdate:modelValue":a[1]||(a[1]=r=>n.query=r),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCustomLocation")},{append:s(()=>[n.query!==""?(l(),C(c,{key:0,name:"close",onClick:a[0]||(a[0]=r=>n.query=""),class:"cursor-pointer"})):(l(),C(c,{key:1,name:"search"}))]),after:s(()=>[t(k,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:o.searchAroundMe,color:o.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),t(D,{onRefresh:o.refresh},{default:s(()=>[t(F,{ref:"scrollTargetRef",class:"scroll"},{default:s(()=>[(l(!0),m(L,null,q(o.customLocations,(r,_)=>(l(),m("div",{key:_},[t(I,{onLeft:p=>o.goTo(p,r)},{left:s(()=>[t(c,{name:"assist_walker"})]),default:s(()=>[t(M,{clickable:"",onClick:p=>o.customLocationClick(r.id)},{default:s(()=>[t(y,{avatar:"",top:""},{default:s(()=>[t(z,{icon:"info",color:"primary","text-color":"white"}),t(c,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),t(y,null,{default:s(()=>[t(f,{lines:"1"},{default:s(()=>[r.isAuthor?(l(),m("span",B,[t(c,{name:"check"})])):b("",!0),g(" "+i(r.id)+" - "+i(r.name),1)]),_:2},1024),t(f,{caption:""},{default:s(()=>[g(i(e.$t("type"))+": "+i(r.type)+", "+i(e.$t("date"))+": "+i(n.formatDate(r.createdDate)),1)]),_:2},1024),t(f,{caption:""},{default:s(()=>[g(i(e.$t("organizations"))+": ",1),t(Q,{organizations:r.organizations},null,8,["organizations"])]),_:2},1024),r.distance?(l(),C(f,{key:0,caption:""},{default:s(()=>[g(i(e.$t("distance"))+": "+i(parseInt(r.distance))+" m",1)]),_:2},1024)):b("",!0)]),_:2},1024),t(y,{side:""},{default:s(()=>[t(c,{name:"map",color:"green",size:"lg",onClick:$(p=>o.showOnMapClick(r),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),t(O)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),t(k,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var Z=S(V,[["render",A]]);export{Z as default};
