import{aI as S,bG as b,_ as w,r as P,bF as N,j as n,k as h,d as a,Q as t,X as C,Z as x,F as y,P as m,am as l,aO as k,bH as _,bB as q,R as u,U as c,bD as F}from"./index.18ea7970.js";import{Q as j,c as v,d as p,a as d}from"./format.85b5a3f8.js";import{Q as A,a as D}from"./QPullToRefresh.d7475729.js";import{u as I}from"./use-quasar.c588333e.js";const M=S("excursions",{state:()=>({excursions:[],searchParameters:{name:"",pageNumber:1,sort:null,sortDirection:null,my:!1},totalPages:0,searching:!1,searchAbort:new AbortController}),getters:{getExcursions(e){return e.excursions},getTotalPages(e){return e.totalPages},getQuery(e){return e.searchParameters.name},getPageNumber(e){return e.searchParameters.pageNumber},getCurrentSort(e){return e.searchParameters.sort},getSearchingStatus(e){return e.searching}},actions:{addQueryParameter(e){this.searchParameters.name=e,this.searchParameters.pageNumber=1},onlyMyExcursions(e){this.searchParameters.my=e,this.searchParameters.pageNumber=1},incrementPageNumber(){this.searchParameters.pageNumber++},async searchForExcursions(){this.searching&&this.searchAbort.abort(),this.searching=!0,this.searchAbort=new AbortController;try{const e=await b.get("/api/excursions",{params:this.searchParameters,signal:this.searchAbort.signal});this.totalPages=JSON.parse(e.headers.pagination).totalPages,this.searchParameters.pageNumber>1?e.data.map(r=>this.excursions.push(r)):this.excursions=e.data}catch(e){console.error(e)}finally{this.searching=!1}},async joinExcursion(e){try{await b.post(`/api/excursions/${e.id}/join`);const r=this.excursions.find(g=>g.id===e.id);r.requestedJoin=!0}catch(r){console.error(r)}}}}),T={name:"ExcursionSearchPage",setup(){const{dialog:e}=I(),r=M(),g=P(r.getQuery),i=P(!1);return r.getExcursions.length===0&&r.searchForExcursions().then(()=>{console.log("excursions loaded")}),{confirmDialog:e,store:r,mine:i,query:g,formatDate:N}},computed:{excursions(){return this.store.getExcursions},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},searching(){return this.store.getSearchingStatus}},watch:{query(e,r){this.executeSearch()}},methods:{canJoinExcursion(e){return!e.meParticipant&&!e.requestedJoin},excursionClick(e){this.$router.push({name:"trips-details",params:{id:e}})},joinExcursion({reset:e},r){e(),this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("joinExcursionText")}${r.name}`,cancel:!0,persistent:!0}).onOk(async()=>{await this.store.joinExcursion(r)})},async onlyMine(){this.store.onlyMyExcursions(this.mine=!this.mine),await this.store.searchForExcursions()},async executeSearch(){this.store.addQueryParameter(this.query),await this.store.searchForExcursions()},async loadMore(){this.store.incrementPageNumber(),await this.store.searchForExcursions()},async refresh(e){await this.store.searchForExcursions(),e()}}};function J(e,r,g,i,z,o){return n(),h(y,null,[a(C,{loading:o.searching,modelValue:i.query,"onUpdate:modelValue":r[1]||(r[1]=s=>i.query=s),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForExcursion")},{append:t(()=>[i.query!==""?(n(),m(l,{key:0,name:"close",onClick:r[0]||(r[0]=s=>i.query=""),class:"cursor-pointer"})):(n(),m(l,{key:1,name:"search"}))]),after:t(()=>[a(x,{round:"",dense:"",flat:"",icon:"check",onClick:o.onlyMine,color:i.mine?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),a(A,{onRefresh:o.refresh},{default:t(()=>[a(j,{ref:"scrollTargetRef",class:"scroll"},{default:t(()=>[(n(!0),h(y,null,k(o.excursions,(s,E)=>(n(),h("div",{key:E},[a(D,{onLeft:f=>o.joinExcursion(f,s)},_({default:t(()=>[a(v,{clickable:"",onClick:f=>o.excursionClick(s.id)},{default:t(()=>[a(p,{avatar:"",top:""},{default:t(()=>[a(q,{icon:"info",color:"primary","text-color":"white"}),s.meParticipant?(n(),m(l,{key:0,name:"check",color:"green",size:"lg"})):s.requestedJoin?(n(),h(y,{key:1},[a(l,{name:"check",color:"grey",size:"smc"}),a(d,{caption:""},{default:t(()=>[u(c(e.$t("requested")),1)]),_:1})],64)):(n(),m(l,{key:2,name:"keyboard_double_arrow_right",size:"lg",color:"primary"}))]),_:2},1024),a(p,null,{default:t(()=>[a(d,{lines:"1"},{default:t(()=>[u(c(s.name),1)]),_:2},1024),a(d,{caption:""},{default:t(()=>[u(c(e.$t("date"))+": "+c(i.formatDate(s.dateOfExcursion)),1)]),_:2},1024),a(d,{caption:""},{default:t(()=>[u(c(e.$t("excursionParticipants"))+": "+c(s.participants),1)]),_:2},1024)]),_:2},1024),a(p,{side:""},{default:t(()=>[(n(!0),h(y,null,k(s.organizations,(f,Q)=>(n(),m(d,{caption:"",key:Q},{default:t(()=>[u(c(f.name),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},[o.canJoinExcursion(s)?{name:"left",fn:t(()=>[a(l,{name:"check"}),u(" "+c(e.$t("joinExcursion")),1)]),key:"0"}:void 0]),1032,["onLeft"]),a(F)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),a(x,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:o.loadMore,disabled:o.totalPages<=o.pageNumber},null,8,["label","onClick","disabled"])],64)}var O=w(T,[["render",J]]);export{O as default};
